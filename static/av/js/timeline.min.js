/*
	TimelineJS
	Version 2.17
	Designed and built by Zach Wise at V\u00e9rit\u00e9Co

	This Source Code Form is subject to the terms of the Mozilla Public
	License, v. 2.0. If a copy of the MPL was not distributed with this
	file, You can obtain one at http://mozilla.org/MPL/2.0/.
	
*/
/*
	StoryJS
	Designed and built by Zach Wise at V\u00e9rit\u00e9Co

	This Source Code Form is subject to the terms of the Mozilla Public
	License, v. 2.0. If a copy of the MPL was not distributed with this
	file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/
(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,j){return function(){var l=this._super;this._super=f[h];var k=j.apply(this,arguments);this._super=l;return k}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();var global=(function(){return this||(1,eval)("this")}());if(typeof VMM=="undefined"){var VMM=Class.extend({});VMM.debug=true;VMM.master_config=({init:function(){return this},sizes:{api:{width:0,height:0}},vp:"Pellentesque nibh felis, eleifend id, commodo in, interdum vitae, leo",api_keys_master:{flickr:"RAIvxHY4hE/Elm5cieh4X5ptMyDpj7MYIxziGxi0WGCcy1s+yr7rKQ==",google:"uQKadH1VMlCsp560gN2aOiMz4evWkl1s34yryl3F/9FJOsn+/948CbBUvKLN46U=",twitter:""},timers:{api:7000},api:{pushques:[]},twitter:{active:false,array:[],api_loaded:false,que:[]},flickr:{active:false,array:[],api_loaded:false,que:[]},youtube:{active:false,array:[],api_loaded:false,que:[]},vimeo:{active:false,array:[],api_loaded:false,que:[]},webthumb:{active:false,array:[],api_loaded:false,que:[]},googlemaps:{active:false,map_active:false,places_active:false,array:[],api_loaded:false,que:[]},googledocs:{active:false,array:[],api_loaded:false,que:[]},googleplus:{active:false,array:[],api_loaded:false,que:[]},wikipedia:{active:false,array:[],api_loaded:false,que:[],tries:0},soundcloud:{active:false,array:[],api_loaded:false,que:[]}}).init();VMM.createElement=function(b,e,a,c,d){var f="";if(b!=null&&b!=""){f+="<"+b;if(a!=null&&a!=""){f+=" class='"+a+"'"}if(c!=null&&c!=""){f+=" "+c}if(d!=null&&d!=""){f+=" style='"+d+"'"}f+=">";if(e!=null&&e!=""){f+=e}f=f+"</"+b+">"}return f};VMM.createMediaElement=function(d,b,e){var c="";var a=false;c+="<div class='media'>";if(d!=null&&d!=""){valid=true;c+="<img src='"+d+"'>";if(e!=null&&e!=""){c+=VMM.createElement("div",e,"credit")}if(b!=null&&b!=""){c+=VMM.createElement("div",b,"caption")}}c+="</div>";return c};VMM.hideUrlBar=function(){var d=window,c=d.document;if(!location.hash||!d.addEventListener){window.scrollTo(0,1);var b=1,a=setInterval(function(){if(c.body){clearInterval(a);b="scrollTop" in c.body?c.body.scrollTop:1;d.scrollTo(0,b===1?0:1)}},15);d.addEventListener("load",function(){setTimeout(function(){d.scrollTo(0,b===1?0:1)},0)},false)}}}function trace(a){if(VMM.debug){if(window.console){console.log(a)}else{if(typeof(jsTrace)!="undefined"){jsTrace.send(a)}else{}}}}Array.prototype.remove=function(c,b){var a=this.slice((b||c)+1||this.length);this.length=c<0?this.length+c:c;return this.push.apply(this,a)};Date.prototype.getWeek=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((((this-a)/86400000)+a.getDay()+1)/7)};Date.prototype.getDayOfYear=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((this-a)/86400000)};var is={Null:function(b){return b===null},Undefined:function(b){return b===undefined},nt:function(b){return(b===null||b===undefined)},Function:function(b){return(typeof(b)==="function")?b.constructor.toString().match(/Function/)!==null:false},String:function(b){return(typeof(b)==="string")?true:(typeof(b)==="object")?b.constructor.toString().match(/string/i)!==null:false},Array:function(b){return(typeof(b)==="object")?b.constructor.toString().match(/array/i)!==null||b.length!==undefined:false},Boolean:function(b){return(typeof(b)==="boolean")?true:(typeof(b)==="object")?b.constructor.toString().match(/boolean/i)!==null:false},Date:function(b){return(typeof(b)==="date")?true:(typeof(b)==="object")?b.constructor.toString().match(/date/i)!==null:false},HTML:function(b){return(typeof(b)==="object")?b.constructor.toString().match(/html/i)!==null:false},Number:function(b){return(typeof(b)==="number")?true:(typeof(b)==="object")?b.constructor.toString().match(/Number/)!==null:false},Object:function(b){return(typeof(b)==="object")?b.constructor.toString().match(/object/i)!==null:false},RegExp:function(b){return(typeof(b)==="function")?b.constructor.toString().match(/regexp/i)!==null:false}};var type={of:function(b){for(var c in is){if(is[c](b)){return c.toLowerCase()}}}};if(typeof VMM!="undefined"){VMM.smoothScrollTo=function(a,c,e){if(typeof(jQuery)!="undefined"){var b="easein",d=1000;if(c!=null){if(c<1){d=1}else{d=Math.round(c)}}if(e!=null&&e!=""){b=e}if(jQuery(window).scrollTop()!=VMM.Lib.offset(a).top){VMM.Lib.animate("html,body",d,b,{scrollTop:VMM.Lib.offset(a).top})}}};VMM.attachElement=function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).html(b)}};VMM.appendElement=function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).append(b)}};VMM.getHTML=function(a){var b;if(typeof(jQuery)!="undefined"){b=jQuery(a).html();return b}};VMM.getElement=function(a,c){var b;if(typeof(jQuery)!="undefined"){if(c){b=jQuery(a).parent().get(0)}else{b=jQuery(a).get(0)}return b}};VMM.bindEvent=function(c,f,b,a){var h;var d="click";var g={};if(b!=null&&b!=""){d=b}if(g!=null&&g!=""){g=a}if(typeof(jQuery)!="undefined"){jQuery(c).bind(d,g,f)}};VMM.unbindEvent=function(b,d,a){var g;var c="click";var f={};if(a!=null&&a!=""){c=a}if(typeof(jQuery)!="undefined"){jQuery(b).unbind(c,d)}};VMM.fireEvent=function(c,a,b){var g;var f="click";var d=[];if(a!=null&&a!=""){f=a}if(b!=null&&b!=""){d=b}if(typeof(jQuery)!="undefined"){jQuery(c).trigger(f,d)}};VMM.getJSON=function(b,c,d){if(typeof(jQuery)!="undefined"){jQuery.ajaxSetup({timeout:3000});if(VMM.Browser.browser=="Explorer"&&parseInt(VMM.Browser.version,10)>=7&&window.XDomainRequest){trace("IE JSON");var a=b;if(a.match("^http://")){return jQuery.getJSON(a,c,d)}else{if(a.match("^https://")){a=a.replace("https://","http://");return jQuery.getJSON(a,c,d)}else{return jQuery.getJSON(b,c,d)}}}else{return jQuery.getJSON(b,c,d)}}};VMM.parseJSON=function(a){if(typeof(jQuery)!="undefined"){return jQuery.parseJSON(a)}};VMM.appendAndGetElement=function(g,k,j,f){var d,a="<div>",b="",c="",h="";if(k!=null&&k!=""){a=k}if(j!=null&&j!=""){b=j}if(f!=null&&f!=""){c=f}if(typeof(jQuery)!="undefined"){d=jQuery(k);d.addClass(b);d.html(c);jQuery(g).append(d)}return d};VMM.Lib={init:function(){return this},hide:function(a,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).hide(b)}}else{if(typeof(jQuery)!="undefined"){jQuery(a).hide()}}},remove:function(a){if(typeof(jQuery)!="undefined"){jQuery(a).remove()}},detach:function(a){if(typeof(jQuery)!="undefined"){jQuery(a).detach()}},append:function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).append(b)}},prepend:function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).prepend(b)}},show:function(a,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).show(b)}}else{if(typeof(jQuery)!="undefined"){jQuery(a).show()}}},load:function(b,d,a){var c={elem:b};if(c!=null&&c!=""){c=a}if(typeof(jQuery)!="undefined"){jQuery(b).load(c,d)}},addClass:function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).addClass(a)}},removeClass:function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).removeClass(a)}},attr:function(a,c,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).attr(c,b)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).attr(c)}}},prop:function(a,c,b){if(typeof jQuery=="undefined"||!/[1-9]\.[3-9].[1-9]/.test(jQuery.fn.jquery)){VMM.Lib.attribute(a,c,b)}else{jQuery(a).prop(c,b)}},attribute:function(a,c,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).attr(c,b)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).attr(c)}}},visible:function(b,a){if(a!=null){if(typeof(jQuery)!="undefined"){if(a){jQuery(b).show(0)}else{jQuery(b).hide(0)}}}else{if(typeof(jQuery)!="undefined"){if(jQuery(b).is(":visible")){return true}else{return false}}}},css:function(a,c,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).css(c,b)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).css(c)}}},cssmultiple:function(b,a){if(typeof(jQuery)!="undefined"){return jQuery(b).css(a)}},offset:function(a){var b;if(typeof(jQuery)!="undefined"){b=jQuery(a).offset()}return b},position:function(a){var b;if(typeof(jQuery)!="undefined"){b=jQuery(a).position()}return b},width:function(a,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).width(b)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).width()}}},height:function(a,b){if(b!=null&&b!=""){if(typeof(jQuery)!="undefined"){jQuery(a).height(b)}}else{if(typeof(jQuery)!="undefined"){return jQuery(a).height()}}},toggleClass:function(b,a){if(typeof(jQuery)!="undefined"){jQuery(b).toggleClass(a)}},each:function(a,b){if(typeof(jQuery)!="undefined"){jQuery(a).each(b)}},html:function(a,c){var b;if(typeof(jQuery)!="undefined"){b=jQuery(a).html();return b}if(c!=null&&c!=""){if(typeof(jQuery)!="undefined"){jQuery(a).html(c)}}else{var b;if(typeof(jQuery)!="undefined"){b=jQuery(a).html();return b}}},find:function(b,a){if(typeof(jQuery)!="undefined"){return jQuery(b).find(a)}},stop:function(a){if(typeof(jQuery)!="undefined"){jQuery(a).stop()}},delay_animate:function(b,c,e,g,a,d){if(VMM.Browser.device=="mobile"||VMM.Browser.device=="tablet"){var h=Math.round((e/1500)*10)/10,f=h+"s";VMM.Lib.css(c,"-webkit-transition","all "+f+" ease");VMM.Lib.css(c,"-moz-transition","all "+f+" ease");VMM.Lib.css(c,"-o-transition","all "+f+" ease");VMM.Lib.css(c,"-ms-transition","all "+f+" ease");VMM.Lib.css(c,"transition","all "+f+" ease");VMM.Lib.cssmultiple(c,_att)}else{if(typeof(jQuery)!="undefined"){jQuery(c).delay(b).animate(a,{duration:e,easing:g})}}},animate:function(g,d,c,j,h,m){var a="easein",k=false,f=1000,l={};if(d!=null){if(d<1){f=1}else{f=Math.round(d)}}if(c!=null&&c!=""){a=c}if(h!=null&&h!=""){k=h}if(j!=null){l=j}else{l={opacity:0}}if(VMM.Browser.device=="mobile"||VMM.Browser.device=="tablet"){var b=Math.round((f/1500)*10)/10,e=b+"s";a=" cubic-bezier(0.33, 0.66, 0.66, 1)";for(x in l){if(Object.prototype.hasOwnProperty.call(l,x)){trace(x+" to "+l[x]);VMM.Lib.css(g,"-webkit-transition",x+" "+e+a);VMM.Lib.css(g,"-moz-transition",x+" "+e+a);VMM.Lib.css(g,"-o-transition",x+" "+e+a);VMM.Lib.css(g,"-ms-transition",x+" "+e+a);VMM.Lib.css(g,"transition",x+" "+e+a)}}VMM.Lib.cssmultiple(g,l)}else{if(typeof(jQuery)!="undefined"){if(m!=null&&m!=""){jQuery(g).animate(l,{queue:k,duration:f,easing:a,complete:m})}else{jQuery(g).animate(l,{queue:k,duration:f,easing:a})}}}}}}if(typeof(jQuery)!="undefined"){(function(a){if(window.XDomainRequest){a.ajaxTransport(function(c){if(c.crossDomain&&c.async){if(c.timeout){c.xdrTimeout=c.timeout;delete c.timeout}var b;return{send:function(e,d){function f(g,k,j,h){b.onload=b.onerror=b.ontimeout=a.noop;b=undefined;d(g,k,j,h)}b=new XDomainRequest();b.open(c.type,c.url);b.onload=function(){f(200,"OK",{text:b.responseText},"Content-Type: "+b.contentType)};b.onerror=function(){f(404,"Not Found")};if(c.xdrTimeout){b.ontimeout=function(){f(0,"timeout")};b.timeout=c.xdrTimeout}b.send((c.hasContent&&c.data)||null)},abort:function(){if(b){b.onerror=a.noop();b.abort()}}}}})}})(jQuery);jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,f,a,h,g){return jQuery.easing[jQuery.easing.def](e,f,a,h,g)},easeInExpo:function(e,f,a,h,g){return(f==0)?a:h*Math.pow(2,10*(f/g-1))+a},easeOutExpo:function(e,f,a,h,g){return(f==g)?a+h:h*(-Math.pow(2,-10*f/g)+1)+a},easeInOutExpo:function(e,f,a,h,g){if(f==0){return a}if(f==g){return a+h}if((f/=g/2)<1){return h/2*Math.pow(2,10*(f-1))+a}return h/2*(-Math.pow(2,-10*--f)+2)+a},easeInQuad:function(e,f,a,h,g){return h*(f/=g)*f+a},easeOutQuad:function(e,f,a,h,g){return -h*(f/=g)*(f-2)+a},easeInOutQuad:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f+a}return -h/2*((--f)*(f-2)-1)+a}})}if(typeof VMM!="undefined"&&typeof VMM.Browser=="undefined"){VMM.Browser={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";this.device=this.searchDevice(navigator.userAgent);this.orientation=this.searchOrientation(window.orientation)},searchOrientation:function(a){var b="";if(a==0||a==180){b="portrait"}else{if(a==90||a==-90){b="landscape"}else{b="normal"}}return b},searchDevice:function(b){var a="";if(b.match(/Android/i)||b.match(/iPhone|iPod/i)){a="mobile"}else{if(b.match(/iPad/i)){a="tablet"}else{if(b.match(/BlackBerry/i)||b.match(/IEMobile/i)){a="other mobile"}else{a="desktop"}}}return a},searchString:function(d){for(var a=0;a<d.length;a++){var b=d[a].string,c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!=-1){return d[a].identity}}else{if(c){return d[a].identity}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a==-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};VMM.Browser.init()}if(typeof VMM!="undefined"&&typeof VMM.FileExtention=="undefined"){VMM.FileExtention={googleDocType:function(c){var f=c.replace(/\s\s*$/,""),e="",b=["DOC","DOCX","XLS","XLSX","PPT","PPTX","PDF","PAGES","AI","PSD","TIFF","DXF","SVG","EPS","PS","TTF","XPS","ZIP","RAR"],a=false;e=f.substr(f.length-5,5);for(var d=0;d<b.length;d++){if(e.toLowerCase().match(b[d].toString().toLowerCase())||f.match("docs.google.com")){a=true}}return a}}}if(typeof VMM!="undefined"&&typeof VMM.Date=="undefined"){VMM.Date=({init:function(){return this},dateformats:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time_no_seconds_short:"h:MM TT",time_no_seconds_small_date:"h:MM TT'<br/><small>'mmmm d',' yyyy'</small>'",full_long:"mmm d',' yyyy 'at' hh:MM TT",full_long_small_date:"hh:MM TT'<br/><small>mmm d',' yyyy'</small>'"},month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr:["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_abbr:["Sun.","Mon.","Tues.","Wed.","Thurs.","Fri.","Sat."],hour:[1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12],hour_suffix:["am"],bc_format:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time_no_seconds_short:"h:MM TT",time_no_seconds_small_date:"dddd', 'h:MM TT'<br/><small>'mmmm d',' yyyy'</small>'",full_long:"dddd',' mmm d',' yyyy 'at' hh:MM TT",full_long_small_date:"hh:MM TT'<br/><small>'dddd',' mmm d',' yyyy'</small>'"},setLanguage:function(a){trace("SET DATE LANGUAGE");VMM.Date.dateformats=a.dateformats;VMM.Date.month=a.date.month;VMM.Date.month_abbr=a.date.month_abbr;VMM.Date.day=a.date.day;VMM.Date.day_abbr=a.date.day_abbr;dateFormat.i18n.dayNames=a.date.day_abbr.concat(a.date.day);dateFormat.i18n.monthNames=a.date.month_abbr.concat(a.date.month)},parse:function(h){var b,g,f,e;if(type.of(h)=="date"){b=h}else{b=new Date(0,0,1,0,0,0,0);if(h.match(/,/gi)){g=h.split(",");for(var c=0;c<g.length;c++){g[c]=parseInt(g[c],10)}if(g[0]){b.setFullYear(g[0])}if(g[1]>1){b.setMonth(g[1]-1)}if(g[2]>1){b.setDate(g[2])}if(g[3]>1){b.setHours(g[3])}if(g[4]>1){b.setMinutes(g[4])}if(g[5]>1){b.setSeconds(g[5])}if(g[6]>1){b.setMilliseconds(g[6])}}else{if(h.match("/")){if(h.match(" ")){e=h.split(" ");if(h.match(":")){f=e[1].split(":");if(f[0]>=1){b.setHours(f[0])}if(f[1]>=1){b.setMinutes(f[1])}if(f[2]>=1){b.setSeconds(f[2])}if(f[3]>=1){b.setMilliseconds(f[3])}}g=e[0].split("/")}else{g=h.split("/")}if(g[2]){b.setFullYear(g[2])}if(g[0]>1){b.setMonth(g[0]-1)}if(g[1]>1){b.setDate(g[1])}}else{if(h.match("now")){var a=new Date();b.setFullYear(a.getFullYear());b.setMonth(a.getMonth());b.setDate(a.getDate());if(h.match("hours")){b.setHours(a.getHours())}if(h.match("minutes")){b.setHours(a.getHours());b.setMinutes(a.getMinutes())}if(h.match("seconds")){b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds())}if(h.match("milliseconds")){b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds());b.setMilliseconds(a.getMilliseconds())}}else{if(h.length<=5){b.setFullYear(parseInt(h,10));b.setMonth(0);b.setDate(1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0)}else{if(h.match("T")){if(navigator.userAgent.match(/MSIE\s(?!9.0)/)){e=h.split("T");if(h.match(":")){f=_time_parse[1].split(":");if(f[0]>=1){b.setHours(f[0])}if(f[1]>=1){b.setMinutes(f[1])}if(f[2]>=1){b.setSeconds(f[2])}if(f[3]>=1){b.setMilliseconds(f[3])}}_d_array=e[0].split("-");if(g[0]){b.setFullYear(g[0])}if(g[1]>1){b.setMonth(g[1]-1)}if(g[2]>1){b.setDate(g[2])}}else{b=new Date(Date.parse(h))}}else{b=new Date(parseInt(h.slice(0,4),10),parseInt(h.slice(4,6),10)-1,parseInt(h.slice(6,8),10),parseInt(h.slice(8,10),10),parseInt(h.slice(10,12),10))}}}}}}return b},prettyDate:function(m,n,a){var p,b,o,e,c=false,f,k,l;if(a!=null){c=true}if(type.of(m)=="date"){if(m.getMonth()===0&&m.getDate()==1&&m.getHours()===0&&m.getMinutes()===0){o=VMM.Date.dateformats.year}else{if(m.getDate()<=1&&m.getHours()===0&&m.getMinutes()===0){if(n){o=VMM.Date.dateformats.month_short}else{o=VMM.Date.dateformats.month}}else{if(m.getHours()===0&&m.getMinutes()===0){if(n){o=VMM.Date.dateformats.full_short}else{o=VMM.Date.dateformats.full}}else{if(m.getMinutes()===0){if(n){o=VMM.Date.dateformats.time_no_seconds_short}else{o=VMM.Date.dateformats.time_no_seconds_small_date}}else{if(n){o=VMM.Date.dateformats.time_no_seconds_short}else{o=VMM.Date.dateformats.full_long}}}}}p=dateFormat(m,o,false);e=p.split(" ");for(var h=0;h<e.length;h++){if(parseInt(e[h],10)<0){trace("YEAR IS BC");f=e[h];k=Math.abs(parseInt(e[h],10));l=k.toString()+" B.C.";p=p.replace(f,l)}}if(c){b=dateFormat(a,o);e=b.split(" ");for(var g=0;g<e.length;g++){if(parseInt(e[g],10)<0){trace("YEAR IS BC");f=e[g];k=Math.abs(parseInt(e[g],10));l=k.toString()+" B.C.";b=b.replace(f,l)}}}}else{trace("NOT A VALID DATE?");trace(m)}if(c){return p+" &mdash; "+b}else{return p}}}).init();var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c=function(f,e){f=String(f);e=e||2;while(f.length<e){f="0"+f}return f};return function(j,w,r){var g=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(j)=="[object String]"&&!/\d/.test(j)){w=j;j=undefined}if(isNaN(j)){trace("invalid date "+j)}w=String(g.masks[w]||w||g.masks["default"]);if(w.slice(0,4)=="UTC:"){w=w.slice(4);r=true}var u=r?"getUTC":"get",n=j[u+"Date"](),e=j[u+"Day"](),k=j[u+"Month"](),q=j[u+"FullYear"](),t=j[u+"Hours"](),l=j[u+"Minutes"](),v=j[u+"Seconds"](),p=j[u+"Milliseconds"](),f=r?0:j.getTimezoneOffset(),h={d:n,dd:c(n),ddd:g.i18n.dayNames[e],dddd:g.i18n.dayNames[e+7],m:k+1,mm:c(k+1),mmm:g.i18n.monthNames[k],mmmm:g.i18n.monthNames[k+12],yy:String(q).slice(2),yyyy:q,h:t%12||12,hh:c(t%12||12),H:t,HH:c(t),M:l,MM:c(l),s:v,ss:c(v),l:c(p,3),L:c(p>99?Math.round(p/10):p),t:t<12?"a":"p",tt:t<12?"am":"pm",T:t<12?"A":"P",TT:t<12?"AM":"PM",Z:r?"UTC":(String(j).match(b)||[""]).pop().replace(d,""),o:(f>0?"-":"+")+c(Math.floor(Math.abs(f)/60)*100+Math.abs(f)%60,4),S:["th","st","nd","rd"][n%10>3?0:(n%100-n%10!=10)*n%10]};return w.replace(a,function(m){return m in h?h[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){return dateFormat(this,a,b)}}if(typeof VMM!="undefined"&&typeof VMM.Util=="undefined"){VMM.Util=({init:function(){return this},correctProtocol:function(b){var d=(window.parent.location.protocol).toString(),c="",a=b.split("://",2);if(d.match("http")){c=d}else{c="https"}return c+"://"+a[1]},mergeConfig:function(b,c){var a;for(a in c){if(Object.prototype.hasOwnProperty.call(c,a)){b[a]=c[a]}}return b},getObjectAttributeByIndex:function(d,b){if(typeof d!="undefined"){var c=0;for(var a in d){if(b===c){return d[a]}c++}return""}else{return""}},ordinal:function(a){return["th","st","nd","rd"][(!(((a%10)>3)||(Math.floor(a%100/10)==1)))*(a%10)]},randomBetween:function(b,a){return Math.floor(Math.random()*(a-b+1)+b)},average:function(d){var g={mean:0,variance:0,deviation:0},e=d.length;for(var b,f=0,c=e;c--;f+=d[c]){}for(b=g.mean=f/e,c=e,f=0;c--;f+=Math.pow(d[c]-b,2)){}return g.deviation=Math.sqrt(g.variance=f/e),g},customSort:function(e,c){var d=e,f=c;if(d==f){return 0}return d>f?1:-1},deDupeArray:function(b){var d,a=b.length,c=[],e={};for(d=0;d<a;d++){e[b[d]]=0}for(d in e){c.push(d)}return c},number2money:function(e,c,d){var c=(c!==null)?c:true;var d=(d!==null)?d:false;var a=VMM.Math2.floatPrecision(e,2);var b=this.niceNumber(a);if(!b.split(/\./g)[1]&&d){b=b+".00"}if(c){b="$"+b}return b},wordCount:function(c){var f=c+" ";var h=/^[^A-Za-z0-9\'\-]+/gi;var b=f.replace(h,"");var a=/[^A-Za-z0-9\'\-]+/gi;var d=b.replace(a," ");var e=d.split(" ");var g=e.length-1;if(f.length<2){g=0}return g},ratio:{fit:function(a,d,b,e){var c={width:0,height:0};c.width=a;c.height=Math.round((a/b)*e);if(c.height>d){c.height=d;c.width=Math.round((d/e)*b);if(c.width>a){trace("FIT: DIDN'T FIT!!! ")}}return c},r16_9:function(a,b){if(a!==null&&a!==""){return Math.round((b/16)*9)}else{if(b!==null&&b!==""){return Math.round((a/9)*16)}}},r4_3:function(a,b){if(a!==null&&a!==""){return Math.round((b/4)*3)}else{if(b!==null&&b!==""){return Math.round((a/3)*4)}}}},doubledigit:function(a){return(a<10?"0":"")+a},truncateWords:function(k,c,g){if(!c){c=30}if(!g){g=c}var d=/^[^A-Za-z0-9\'\-]+/gi;var h=k.replace(d,"");var f=h.split(" ");var l=[];c=Math.min(f.length,c);g=Math.min(f.length,g);for(var e=0;e<c;e++){l.push(f[e])}for(var b=c;e<g;e++){var a=f[e];l.push(a);if(a.charAt(a.length-1)=="."){break}}return(l.join(" "))},linkify:function(f,b,d){var c=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim;var e=/(^|[^\/])(www\.[\S]+(\b|$))/gim;var a=/(([a-zA-Z0-9_\-\.]+)@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6}))+/gim;return f.replace(c,"<a target='_blank' href='$&' onclick='void(0)'>$&</a>").replace(e,"$1<a target='_blank' onclick='void(0)' href='http://$2'>$2</a>").replace(a,"<a target='_blank' onclick='void(0)' href='mailto:$1'>$1</a>")},linkify_with_twitter:function(k,j,c){var e=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim;var h=/(\()((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\))|(\[)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\])|(\{)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(\})|(<|&(?:lt|#60|#x3c);)((?:ht|f)tps?:\/\/[a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]+)(>|&(?:gt|#62|#x3e);)|((?:^|[^=\s'"\]])\s*['"]?|[^=\s]\s+)(\b(?:ht|f)tps?:\/\/[a-z0-9\-._~!$'()*+,;=:\/?#[\]@%]+(?:(?!&(?:gt|#0*62|#x0*3e);|&(?:amp|apos|quot|#0*3[49]|#x0*2[27]);[.!&',:?;]?(?:[^a-z0-9\-._~!$&'()*+,;=:\/?#[\]@%]|$))&[a-z0-9\-._~!$'()*+,;=:\/?#[\]@%]*)*[a-z0-9\-_~$()*+=\/#[\]@%])/img;var a='$1$4$7$10$13<a href="$2$5$8$11$14" class="hyphenate">$2$5$8$11$14</a>$3$6$9$12';var l=/(^|[^\/])(www\.[\S]+(\b|$))/gim;function b(n){var m=/(\b(https?|ftp|file):\/\/([-A-Z0-9+&@#%?=~_|!:,.;]*)([-A-Z0-9+&@#%?\/=~_|!:,.;]*)[-A-Z0-9+&@#\/%=~_|])/ig;return n.replace(m,"<a href='$1' target='_blank'>$3</a>")}var d=/(([a-zA-Z0-9_\-\.]+)@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6}))+/gim;var f=/\B@([\w-]+)/gm;var g=/(#([\w]+))/g;return k.replace(h,a).replace(l,"$1<a target='_blank' class='hyphenate' onclick='void(0)' href='http://$2'>$2</a>").replace(d,"<a target='_blank' onclick='void(0)' href='mailto:$1'>$1</a>").replace(f,"<a href='http://twitter.com/$1' target='_blank' onclick='void(0)'>@$1</a>").replace(g,"<a href='http://twitter.com/#search?q=%23$2' target='_blank' 'void(0)'>$1</a>")},linkify_wikipedia:function(b){var a=/<i[^>]*>(.*?)<\/i>/gim;return b.replace(a,"<a target='_blank' href='http://en.wikipedia.org/wiki/$&' onclick='void(0)'>$&</a>").replace(/<i\b[^>]*>/gim,"").replace(/<\/i>/gim,"").replace(/<b\b[^>]*>/gim,"").replace(/<\/b>/gim,"")},unlinkify:function(a){if(!a){return a}a=a.replace(/<a\b[^>]*>/i,"");a=a.replace(/<\/a>/i,"");return a},untagify:function(a){if(!a){return a}a=a.replace(/<\s*\w.*?>/g,"");return a},nl2br:function(a){return a.replace(/(\r\n|[\r\n]|\\n|\\r)/g,"<br/>")},unique_ID:function(a){var c=function(e){return Math.floor(Math.random()*e)};var b=function(){var e="abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";return e.substr(c(62),1)};var d=function(f){var g="";for(var e=0;e<f;e++){g+=b()}return g};return d(a)},isEven:function(a){return(a%2===0)?true:false},getUrlVars:function(b){var f=b.toString();if(f.match("&#038;")){f=f.replace("&#038;","&")}else{if(f.match("&#38;")){f=f.replace("&#38;","&")}else{if(f.match("&amp;")){f=f.replace("&amp;","&")}}}var e=[],d;var a=f.slice(f.indexOf("?")+1).split("&");for(var c=0;c<a.length;c++){d=a[c].split("=");e.push(d[0]);e[d[0]]=d[1]}return e},toHTML:function(a){a=this.nl2br(a);a=this.linkify(a);return a.replace(/\s\s/g,"&nbsp;&nbsp;")},toCamelCase:function(d,b){if(b!==false){b=true}var a=((b)?d.toLowerCase():d).split(" ");for(var c=0;c<a.length;c++){a[c]=a[c].substr(0,1).toUpperCase()+a[c].substr(1)}return a.join(" ")},properQuotes:function(a){return a.replace(/\"([^\"]*)\"/gi,"&#8220;$1&#8221;")},niceNumber:function(b){b+="";x=b.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1,$2")}return x1+x2},toTitleCase:function(b){if(VMM.Browser.browser=="Explorer"&&parseInt(VMM.Browser.version,10)>=7){return b.replace("_","%20")}else{var a={__smallWords:["a","an","and","as","at","but","by","en","for","if","in","of","on","or","the","to","v[.]?","via","vs[.]?"],init:function(){this.__smallRE=this.__smallWords.join("|");this.__lowerCaseWordsRE=new RegExp("\\b("+this.__smallRE+")\\b","gi");this.__firstWordRE=new RegExp("^([^a-zA-Z0-9 \\r\\n\\t]*)("+this.__smallRE+")\\b","gi");this.__lastWordRE=new RegExp("\\b("+this.__smallRE+")([^a-zA-Z0-9 \\r\\n\\t]*)$","gi")},toTitleCase:function(d){var c="";var f=d.split(/([:.;?!][ ]|(?:[ ]|^)["\u201c])/);for(var e=0;e<f.length;++e){var g=f[e];g=g.replace(/\b([a-zA-Z][a-z.'\u2019]*)\b/g,this.__titleCaseDottedWordReplacer);g=g.replace(this.__lowerCaseWordsRE,this.__lowerReplacer);g=g.replace(this.__firstWordRE,this.__firstToUpperCase);g=g.replace(this.__lastWordRE,this.__firstToUpperCase);c+=g}c=c.replace(/ V(s?)\. /g," v$1. ");c=c.replace(/(['\u2019])S\b/g,"$1s");c=c.replace(/\b(AT&T|Q&A)\b/ig,this.__upperReplacer);return c},__titleCaseDottedWordReplacer:function(c){return(c.match(/[a-zA-Z][.][a-zA-Z]/))?c:a.__firstToUpperCase(c)},__lowerReplacer:function(c){return c.toLowerCase()},__upperReplacer:function(c){return c.toUpperCase()},__firstToUpperCase:function(c){var d=c.split(/(^[^a-zA-Z0-9]*[a-zA-Z0-9])(.*)$/);if(d[1]){d[1]=d[1].toUpperCase()}return d.join("")}};a.init();b=b.replace(/_/g," ");b=a.toTitleCase(b);return b}}}).init()}LazyLoad=(function(k){var g,h,b={},e=0,f={css:[],js:[]},n=k.styleSheets;function m(q,p){var r=k.createElement(q),o;for(o in p){if(p.hasOwnProperty(o)){r.setAttribute(o,p[o])}}return r}function j(o){var r=b[o],s,q;if(r){s=r.callback;q=r.urls;q.shift();e=0;if(!q.length){s&&s.call(r.context,r.obj);b[o]=null;f[o].length&&l(o)}}}function c(){var o=navigator.userAgent;g={async:k.createElement("script").async===true};(g.webkit=/AppleWebKit\//.test(o))||(g.ie=/MSIE/.test(o))||(g.opera=/Opera/.test(o))||(g.gecko=/Gecko\//.test(o))||(g.unknown=true)}function l(B,A,C,w,s){var u=function(){j(B)},D=B==="css",q=[],v,y,t,r,z,o;g||c();if(A){A=typeof A==="string"?[A]:A.concat();if(D||g.async||g.gecko||g.opera){f[B].push({urls:A,callback:C,obj:w,context:s})}else{for(v=0,y=A.length;v<y;++v){f[B].push({urls:[A[v]],callback:v===y-1?C:null,obj:w,context:s})}}}if(b[B]||!(r=b[B]=f[B].shift())){return}h||(h=k.head||k.getElementsByTagName("head")[0]);z=r.urls;for(v=0,y=z.length;v<y;++v){o=z[v];if(D){t=g.gecko?m("style"):m("link",{href:o,rel:"stylesheet"})}else{t=m("script",{src:o});t.async=false}t.className="lazyload";t.setAttribute("charset","utf-8");if(g.ie&&!D){t.onreadystatechange=function(){if(/loaded|complete/.test(t.readyState)){t.onreadystatechange=null;u()}}}else{if(D&&(g.gecko||g.webkit)){if(g.webkit){r.urls[v]=t.href;d()}else{t.innerHTML='@import "'+o+'";';a(t)}}else{t.onload=t.onerror=u}}q.push(t)}for(v=0,y=q.length;v<y;++v){h.appendChild(q[v])}}function a(q){var p;try{p=!!q.sheet.cssRules}catch(o){e+=1;if(e<200){setTimeout(function(){a(q)},50)}else{p&&j("css")}return}j("css")}function d(){var p=b.css,o;if(p){o=n.length;while(--o>=0){if(n[o].href===p.urls[0]){j("css");break}}e+=1;if(p){if(e<200){setTimeout(d,50)}else{j("css")}}}}return{css:function(q,r,p,o){l("css",q,r,p,o)},js:function(q,r,p,o){l("js",q,r,p,o)}}})(this.document);LoadLib=(function(c){var b=[];function a(d){var f=0,e=false;for(f=0;f<b.length;f++){if(b[f]==d){e=true}}if(e){return true}else{b.push(d);return false}}return{css:function(f,g,e,d){if(!a(f)){LazyLoad.css(f,g,e,d)}},js:function(f,g,e,d){if(!a(f)){LazyLoad.js(f,g,e,d)}}}})(this.document);if(typeof VMM!="undefined"&&typeof VMM.Language=="undefined"){VMM.Language={lang:"en",api:{wikipedia:"en"},date:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr:["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_abbr:["Sun.","Mon.","Tues.","Wed.","Thurs.","Fri.","Sat."]},dateformats:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time_no_seconds_short:"h:MM TT",time_no_seconds_small_date:"h:MM TT'<br/><small>'mmmm d',' yyyy'</small>'",full_long:"mmm d',' yyyy 'at' h:MM TT",full_long_small_date:"h:MM TT'<br/><small>mmm d',' yyyy'</small>'"},messages:{loading_timeline:"Loading Timeline... ",return_to_title:"Return to Title",expand_timeline:"Expand Timeline",contract_timeline:"Contract Timeline",wikipedia:"From Wikipedia, the free encyclopedia",loading_content:"Loading Content",loading:"Loading"}}}if(typeof VMM!="undefined"&&typeof VMM.ExternalAPI=="undefined"){VMM.ExternalAPI=({keys:{google:"",flickr:"",twitter:""},keys_master:{vp:"Pellentesque nibh felis, eleifend id, commodo in, interdum vitae, leo",flickr:"RAIvxHY4hE/Elm5cieh4X5ptMyDpj7MYIxziGxi0WGCcy1s+yr7rKQ==",google:"jwNGnYw4hE9lmAez4ll0QD+jo6SKBJFknkopLS4FrSAuGfIwyj57AusuR0s8dAo=",twitter:""},init:function(){return this},setKeys:function(a){VMM.ExternalAPI.keys=a},pushQues:function(){if(VMM.master_config.googlemaps.active){VMM.ExternalAPI.googlemaps.pushQue()}if(VMM.master_config.youtube.active){VMM.ExternalAPI.youtube.pushQue()}if(VMM.master_config.soundcloud.active){VMM.ExternalAPI.soundcloud.pushQue()}if(VMM.master_config.googledocs.active){VMM.ExternalAPI.googledocs.pushQue()}if(VMM.master_config.googleplus.active){VMM.ExternalAPI.googleplus.pushQue()}if(VMM.master_config.wikipedia.active){VMM.ExternalAPI.wikipedia.pushQue()}if(VMM.master_config.vimeo.active){VMM.ExternalAPI.vimeo.pushQue()}if(VMM.master_config.twitter.active){VMM.ExternalAPI.twitter.pushQue()}if(VMM.master_config.flickr.active){VMM.ExternalAPI.flickr.pushQue()}if(VMM.master_config.webthumb.active){VMM.ExternalAPI.webthumb.pushQue()}},twitter:{tweetArray:[],get:function(a){var b={mid:a.id,id:a.uid};VMM.master_config.twitter.que.push(b);VMM.master_config.twitter.active=true},create:function(e,g){var f=e.mid.toString(),b={twitterid:e.mid},a="http://api.twitter.com/1/statuses/show.json?id="+e.mid+"&include_entities=true&callback=?",d=setTimeout(VMM.ExternalAPI.twitter.errorTimeOut,VMM.master_config.timers.api,e),c=setTimeout(g,VMM.master_config.timers.api,e);VMM.getJSON(a,function(j){var l=j.id_str,h="<blockquote><p>",k=VMM.Util.linkify_with_twitter(j.text,"_blank");h+=k;h+="</p></blockquote>";if(typeof j.entities.media!="undefined"){if(j.entities.media[0].type=="photo"){}}h+="<div class='vcard author'>";h+="<a class='screen-name url' href='https://twitter.com/"+j.user.screen_name+"' data-screen-name='"+j.user.screen_name+"' target='_blank'>";h+="<span class='avatar'><img src=' "+j.user.profile_image_url+"'  alt=''></span>";h+="<span class='fn'>"+j.user.name+"</span>";h+="<span class='nickname'>@"+j.user.screen_name+"<span class='thumbnail-inline'></span></span>";h+="</a>";h+="</div>";VMM.attachElement("#"+e.id.toString(),h);VMM.attachElement("#text_thumb_"+e.id.toString(),j.text);VMM.attachElement("#marker_content_"+e.id.toString(),j.text)}).error(function(h,k,j){trace("TWITTER error");trace("TWITTER ERROR: "+k+" "+h.responseText);VMM.attachElement("#"+e.id,VMM.MediaElement.loadingmessage("ERROR LOADING TWEET "+e.mid))}).success(function(h){clearTimeout(d);clearTimeout(c);g()})},errorTimeOut:function(a){trace("TWITTER JSON ERROR TIMEOUT "+a.mid);VMM.attachElement("#"+a.id.toString(),VMM.MediaElement.loadingmessage("Still waiting on Twitter: "+a.mid));VMM.getJSON("http://api.twitter.com/1/account/rate_limit_status.json",function(c){trace("REMAINING TWITTER API CALLS "+c.remaining_hits);trace("TWITTER RATE LIMIT WILL RESET AT "+c.reset_time);var b="";if(c.remaining_hits==0){b="<p>You've reached the maximum number of tweets you can load in an hour.</p>";b+="<p>You can view tweets again starting at: <br/>"+c.reset_time+"</p>"}else{b="<p>Still waiting on Twitter. "+a.mid+"</p>"}VMM.attachElement("#"+a.id.toString(),VMM.MediaElement.loadingmessage(b))})},pushQue:function(){if(VMM.master_config.twitter.que.length>0){VMM.ExternalAPI.twitter.create(VMM.master_config.twitter.que[0],VMM.ExternalAPI.twitter.pushQue);VMM.master_config.twitter.que.remove(0)}},getHTML:function(b){var a="http://api.twitter.com/1/statuses/oembed.json?id="+b+"&callback=?";VMM.getJSON(a,VMM.ExternalAPI.twitter.onJSONLoaded)},onJSONLoaded:function(a){trace("TWITTER JSON LOADED");var b=a.id;VMM.attachElement("#"+b,VMM.Util.linkify_with_twitter(a.html))},parseTwitterDate:function(b){var a=new Date(Date.parse(b));return a},prettyParseTwitterDate:function(b){var a=new Date(Date.parse(b));return VMM.Date.prettyDate(a,true)},getTweets:function(f){var e=[];var d=f.length;for(var c=0;c<f.length;c++){var b="";if(f[c].tweet.match("status/")){b=f[c].tweet.split("status/")[1]}else{if(f[c].tweet.match("statuses/")){b=f[c].tweet.split("statuses/")[1]}else{b=""}}var a="http://api.twitter.com/1/statuses/show.json?id="+b+"&include_entities=true&callback=?";VMM.getJSON(a,function(j){var h={};var g="<div class='twitter'><blockquote><p>";var l=VMM.Util.linkify_with_twitter(j.text,"_blank");g+=l;g+="</p>";g+="\u2014 "+j.user.name+" (<a href='https://twitter.com/"+j.user.screen_name+"'>@"+j.user.screen_name+"</a>) <a href='https://twitter.com/"+j.user.screen_name+"/status/"+j.id+"'>"+VMM.ExternalAPI.twitter.prettyParseTwitterDate(j.created_at)+" </a></blockquote></div>";h.content=g;h.raw=j;e.push(h);if(e.length==d){var k={tweetdata:e};VMM.fireEvent(global,"TWEETSLOADED",k)}}).success(function(){trace("second success")}).error(function(){trace("error")}).complete(function(){trace("complete")})}},getTweetSearch:function(e,c){var b=40;if(c!=null&&c!=""){b=c}var a="http://search.twitter.com/search.json?q="+e+"&rpp="+b+"&include_entities=true&result_type=mixed";var d=[];VMM.getJSON(a,function(j){for(var f=0;f<j.results.length;f++){var h={};var g="<div class='twitter'><blockquote><p>";var l=VMM.Util.linkify_with_twitter(j.results[f].text,"_blank");g+=l;g+="</p>";g+="\u2014 "+j.results[f].from_user_name+" (<a href='https://twitter.com/"+j.results[f].from_user+"'>@"+j.results[f].from_user+"</a>) <a href='https://twitter.com/"+j.results[f].from_user+"/status/"+j.id+"'>"+VMM.ExternalAPI.twitter.prettyParseTwitterDate(j.results[f].created_at)+" </a></blockquote></div>";h.content=g;h.raw=j.results[f];d.push(h)}var k={tweetdata:d};VMM.fireEvent(global,"TWEETSLOADED",k)})},prettyHTML:function(e,b){var e=e.toString();var c={twitterid:e};var a="http://api.twitter.com/1/statuses/show.json?id="+e+"&include_entities=true&callback=?";var d=setTimeout(VMM.ExternalAPI.twitter.errorTimeOut,VMM.master_config.timers.api,e);VMM.getJSON(a,VMM.ExternalAPI.twitter.formatJSON).error(function(f,h,g){trace("TWITTER error");trace("TWITTER ERROR: "+h+" "+f.responseText);VMM.attachElement("#twitter_"+e,"<p>ERROR LOADING TWEET "+e+"</p>")}).success(function(f){clearTimeout(d);if(b){VMM.ExternalAPI.twitter.secondaryMedia(f)}})},formatJSON:function(b){var e=b.id_str;var a="<blockquote><p>";var c=VMM.Util.linkify_with_twitter(b.text,"_blank");a+=c;a+="</p></blockquote>";a+="<div class='vcard author'>";a+="<a class='screen-name url' href='https://twitter.com/"+b.user.screen_name+"' data-screen-name='"+b.user.screen_name+"' target='_blank'>";a+="<span class='avatar'><img src=' "+b.user.profile_image_url+"'  alt=''></span>";a+="<span class='fn'>"+b.user.name+"</span>";a+="<span class='nickname'>@"+b.user.screen_name+"<span class='thumbnail-inline'></span></span>";a+="</a>";a+="</div>";if(typeof b.entities.media!="undefined"){if(b.entities.media[0].type=="photo"){a+="<img src=' "+b.entities.media[0].media_url+"'  alt=''>"}}VMM.attachElement("#twitter_"+e.toString(),a);VMM.attachElement("#text_thumb_"+e.toString(),b.text)}},googlemaps:{maptype:"toner",setMapType:function(a){if(a!=""){VMM.ExternalAPI.googlemaps.maptype=a}},get:function(a){var d,b,c;a.vars=VMM.Util.getUrlVars(a.id);if(VMM.ExternalAPI.keys.google!=""){b=VMM.ExternalAPI.keys.google}else{b=Aes.Ctr.decrypt(VMM.ExternalAPI.keys_master.google,VMM.ExternalAPI.keys_master.vp,256)}c="http://maps.googleapis.com/maps/api/js?key="+b+"&libraries=places&sensor=false&callback=VMM.ExternalAPI.googlemaps.onMapAPIReady";if(VMM.master_config.googlemaps.active){VMM.master_config.googlemaps.que.push(a)}else{VMM.master_config.googlemaps.que.push(a);if(VMM.master_config.googlemaps.api_loaded){}else{LoadLib.js(c,function(){trace("Google Maps API Library Loaded")})}}},create:function(a){VMM.ExternalAPI.googlemaps.createAPIMap(a)},createiFrameMap:function(a){var b=a.id+"&output=embed",d="",c=a.uid.toString()+"_gmap";d+="<div class='google-map' id='"+c+"' style='width=100%;height=100%;'>";d+="<iframe width='100%' height='100%' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src='"+b+"'></iframe>";d+="</div>";VMM.attachElement("#"+a.uid,d)},createAPIMap:function(j){var q="",u,r,h,d=j.uid.toString()+"_gmap",g="",b=new google.maps.LatLng(41.875696,-87.624207),e,a=11,f=false,s=false,l=false,p;function o(m){if(m in VMM.ExternalAPI.googlemaps.map_providers){q=VMM.ExternalAPI.googlemaps.map_attribution[VMM.ExternalAPI.googlemaps.map_providers[m].attribution];return VMM.ExternalAPI.googlemaps.map_providers[m]}else{if(VMM.ExternalAPI.googlemaps.defaultType(m)){trace("GOOGLE MAP DEFAULT TYPE");return google.maps.MapTypeId[m.toUpperCase()]}else{trace("Not a maptype: "+m)}}}google.maps.VeriteMapType=function(m){if(VMM.ExternalAPI.googlemaps.defaultType(m)){return google.maps.MapTypeId[m.toUpperCase()]}else{var v=o(m);return google.maps.ImageMapType.call(this,{getTileUrl:function(z,y){var w=(y+z.x+z.y)%VMM.ExternalAPI.googlemaps.map_subdomains.length;return[v.url.replace("{S}",VMM.ExternalAPI.googlemaps.map_subdomains[w]).replace("{Z}",y).replace("{X}",z.x).replace("{Y}",z.y).replace("{z}",y).replace("{x}",z.x).replace("{y}",z.y)]},tileSize:new google.maps.Size(256,256),name:m,minZoom:v.minZoom,maxZoom:v.maxZoom})}};google.maps.VeriteMapType.prototype=new google.maps.ImageMapType("_");if(VMM.ExternalAPI.googlemaps.maptype!=""){if(VMM.ExternalAPI.googlemaps.defaultType(VMM.ExternalAPI.googlemaps.maptype)){u=google.maps.MapTypeId[VMM.ExternalAPI.googlemaps.maptype.toUpperCase()]}else{u=VMM.ExternalAPI.googlemaps.maptype}}else{u="toner"}if(type.of(VMM.Util.getUrlVars(j.id)["ll"])=="string"){f=true;e=VMM.Util.getUrlVars(j.id)["ll"].split(",");b=new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))}else{if(type.of(VMM.Util.getUrlVars(j.id)["sll"])=="string"){e=VMM.Util.getUrlVars(j.id)["sll"].split(",");b=new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))}}if(type.of(VMM.Util.getUrlVars(j.id)["z"])=="string"){s=true;a=parseFloat(VMM.Util.getUrlVars(j.id)["z"])}h={zoom:a,draggable:false,disableDefaultUI:true,mapTypeControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},center:b,mapTypeId:u,mapTypeControlOptions:{mapTypeIds:[u]}};VMM.attachElement("#"+j.uid,"<div class='google-map' id='"+d+"' style='width=100%;height=100%;'></div>");r=new google.maps.Map(document.getElementById(d),h);if(VMM.ExternalAPI.googlemaps.defaultType(VMM.ExternalAPI.googlemaps.maptype)){}else{r.mapTypes.set(u,new google.maps.VeriteMapType(u));g="<div class='map-attribution'><div class='attribution-text'>"+q+"</div></div>";VMM.appendElement("#"+d,g)}if(j.id[0].match("msid")){t()}else{if(type.of(VMM.Util.getUrlVars(j.id)["q"])=="string"){k()}}function k(){var y=new google.maps.Geocoder(),v=VMM.Util.getUrlVars(j.id)["q"],m;if(v.match("loc:")){var w=v.split(":")[1].split("+");b=new google.maps.LatLng(parseFloat(w[0]),parseFloat(w[1]));f=true}y.geocode({address:v},function(A,z){if(z==google.maps.GeocoderStatus.OK){m=new google.maps.Marker({map:r,position:A[0].geometry.location});if(typeof A[0].geometry.viewport!="undefined"){r.fitBounds(A[0].geometry.viewport)}else{if(typeof A[0].geometry.bounds!="undefined"){r.fitBounds(A[0].geometry.bounds)}else{r.setCenter(A[0].geometry.location)}}if(f){r.panTo(b)}if(s){r.setZoom(a)}}else{trace("Geocode for "+v+" was not successful for the following reason: "+z);trace("TRYING PLACES SEARCH");if(f){r.panTo(b)}if(s){r.setZoom(a)}c()}})}function c(){var v,B,z,w,m,A;place_search=new google.maps.places.PlacesService(r);z=new google.maps.InfoWindow();B={query:"",types:["country","neighborhood","political","locality","geocode"]};if(type.of(VMM.Util.getUrlVars(j.id)["q"])=="string"){B.query=VMM.Util.getUrlVars(j.id)["q"]}if(f){B.location=b;B.radius="15000"}else{m=new google.maps.LatLng(-89.999999,-179.999999);A=new google.maps.LatLng(89.999999,179.999999);w=new google.maps.LatLngBounds(m,A)}place_search.textSearch(B,y);function y(F,D){if(D==google.maps.places.PlacesServiceStatus.OK){for(var E=0;E<F.length;E++){}if(f){r.panTo(b)}else{if(F.length>=1){r.panTo(F[0].geometry.location);if(s){r.setZoom(a)}}}}else{trace("Place search for "+B.query+" was not successful for the following reason: "+D);trace("YOU MAY NEED A GOOGLE MAPS API KEY IN ORDER TO USE THIS FEATURE OF TIMELINEJS");trace("FIND OUT HOW TO GET YOUR KEY HERE: https://developers.google.com/places/documentation/#Authentication");if(f){r.panTo(b);if(s){r.setZoom(a)}}else{trace("USING SIMPLE IFRAME MAP EMBED");if(j.id[0].match("https")){j.id=j.url[0].replace("https","http")}VMM.ExternalAPI.googlemaps.createiFrameMap(j)}}}function C(F){var E,D;D=F.geometry.location;E=new google.maps.Marker({map:r,position:F.geometry.location});google.maps.event.addListener(E,"click",function(){z.setContent(F.name);z.open(r,this)})}}function n(){var v,w,m=false;trace("LOADING PLACES API FOR GOOGLE MAPS");if(VMM.ExternalAPI.keys.google!=""){v=VMM.ExternalAPI.keys.google;m=true}else{trace("YOU NEED A GOOGLE MAPS API KEY IN ORDER TO USE THIS FEATURE OF TIMELINEJS");trace("FIND OUT HOW TO GET YOUR KEY HERE: https://developers.google.com/places/documentation/#Authentication")}w="https://maps.googleapis.com/maps/api/place/textsearch/json?key="+v+"&sensor=false&language="+j.lang+"&";if(type.of(VMM.Util.getUrlVars(j.id)["q"])=="string"){w+="query="+VMM.Util.getUrlVars(j.id)["q"]}if(f){w+="&location="+b}if(m){VMM.getJSON(w,function(C){trace("PLACES JSON");var A="",y="",z="",B="";trace(C);if(C.status=="OVER_QUERY_LIMIT"){trace("OVER_QUERY_LIMIT");if(f){r.panTo(b);if(s){r.setZoom(a)}}else{trace("DOING TRADITIONAL MAP IFRAME EMBED UNTIL QUERY LIMIT RESTORED");l=true;VMM.ExternalAPI.googlemaps.createiFrameMap(j)}}else{if(C.results.length>=1){z=new google.maps.LatLng(parseFloat(C.results[0].geometry.viewport.northeast.lat),parseFloat(C.results[0].geometry.viewport.northeast.lng));B=new google.maps.LatLng(parseFloat(C.results[0].geometry.viewport.southwest.lat),parseFloat(C.results[0].geometry.viewport.southwest.lng));y=new google.maps.LatLngBounds(B,z);r.fitBounds(y)}else{trace("NO RESULTS")}if(f){r.panTo(b)}if(s){r.setZoom(a)}}}).error(function(y,A,z){trace("PLACES JSON ERROR");trace("PLACES JSON ERROR: "+A+" "+y.responseText)}).success(function(y){trace("PLACES JSON SUCCESS")})}else{if(f){r.panTo(b);if(s){r.setZoom(a)}}else{trace("DOING TRADITIONAL MAP IFRAME EMBED BECAUSE NO GOOGLE MAP API KEY WAS PROVIDED");VMM.ExternalAPI.googlemaps.createiFrameMap(j)}}}function t(){var m,v,w,y;m=j.id+"&output=kml";m=m.replace("&output=embed","");v=new google.maps.KmlLayer(m,{preserveViewport:true});w=new google.maps.InfoWindow();v.setMap(r);google.maps.event.addListenerOnce(v,"defaultviewport_changed",function(){if(f){r.panTo(b)}else{r.fitBounds(v.getDefaultViewport())}if(s){r.setZoom(a)}});google.maps.event.addListener(v,"click",function(A){y=A.featureData.description;z(y);function z(B){w.setContent(B);w.open(r)}})}},pushQue:function(){for(var a=0;a<VMM.master_config.googlemaps.que.length;a++){VMM.ExternalAPI.googlemaps.create(VMM.master_config.googlemaps.que[a])}VMM.master_config.googlemaps.que=[]},onMapAPIReady:function(){VMM.master_config.googlemaps.map_active=true;VMM.master_config.googlemaps.places_active=true;VMM.ExternalAPI.googlemaps.onAPIReady()},onPlacesAPIReady:function(){VMM.master_config.googlemaps.places_active=true;VMM.ExternalAPI.googlemaps.onAPIReady()},onAPIReady:function(){if(!VMM.master_config.googlemaps.active){if(VMM.master_config.googlemaps.map_active&&VMM.master_config.googlemaps.places_active){VMM.master_config.googlemaps.active=true;VMM.ExternalAPI.googlemaps.pushQue()}}},defaultType:function(a){if(a.toLowerCase()=="satellite"||a.toLowerCase()=="hybrid"||a.toLowerCase()=="terrain"||a.toLowerCase()=="roadmap"){return true}else{return false}},map_subdomains:["","a.","b.","c.","d."],map_attribution:{stamen:"Map tiles by <a href='http://stamen.com'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org'>OpenStreetMap</a>, under <a href='http://creativecommons.org/licenses/by-sa/3.0'>CC BY SA</a>.",apple:"Map data &copy; 2012  Apple, Imagery &copy; 2012 Apple"},map_providers:{toner:{url:"http://{S}tile.stamen.com/toner/{Z}/{X}/{Y}.png",minZoom:0,maxZoom:20,attribution:"stamen"},"toner-lines":{url:"http://{S}tile.stamen.com/toner-lines/{Z}/{X}/{Y}.png",minZoom:0,maxZoom:20,attribution:"stamen"},"toner-labels":{url:"http://{S}tile.stamen.com/toner-labels/{Z}/{X}/{Y}.png",minZoom:0,maxZoom:20,attribution:"stamen"},sterrain:{url:"http://{S}tile.stamen.com/terrain/{Z}/{X}/{Y}.jpg",minZoom:4,maxZoom:20,attribution:"stamen"},apple:{url:"http://gsp2.apple.com/tile?api=1&style=slideshow&layers=default&lang=en_US&z={z}&x={x}&y={y}&v=9",minZoom:4,maxZoom:14,attribution:"apple"},watercolor:{url:"http://{S}tile.stamen.com/watercolor/{Z}/{X}/{Y}.jpg",minZoom:3,maxZoom:16,attribution:"stamen"}}},googleplus:{get:function(a){var c;var b={user:a.user,activity:a.id,id:a.uid};VMM.master_config.googleplus.que.push(b);VMM.master_config.googleplus.active=true},create:function(e,g){var d="",h="",c="",j="",a="",b,f;googleplus_timeout=setTimeout(VMM.ExternalAPI.googleplus.errorTimeOut,VMM.master_config.timers.api,e),callback_timeout=setTimeout(g,VMM.master_config.timers.api,e);if(VMM.master_config.Timeline.api_keys.google!=""){h=VMM.master_config.Timeline.api_keys.google}else{h=Aes.Ctr.decrypt(VMM.master_config.api_keys_master.google,VMM.master_config.vp,256)}b="https://www.googleapis.com/plus/v1/people/"+e.user+"/activities/public?alt=json&maxResults=100&fields=items(id,url)&key="+h;d="GOOGLE PLUS API CALL";VMM.getJSON(b,function(l){for(var k=0;k<l.items.length;k++){trace("loop");if(l.items[k].url.split("posts/")[1]==e.activity){trace("FOUND IT!!");c=l.items[k].id;f="https://www.googleapis.com/plus/v1/activities/"+c+"?alt=json&key="+h;VMM.getJSON(f,function(n){trace(n);if(typeof n.annotation!="undefined"){j+="<div class='googleplus-annotation'>'"+n.annotation+"</div>";j+=n.object.content}else{j+=n.object.content}if(typeof n.object.attachments!="undefined"){for(var m=0;m<n.object.attachments.length;m++){if(n.object.attachments[m].objectType=="photo"){a="<a href='"+n.object.url+"' target='_blank'><img src='"+n.object.attachments[m].image.url+"' class='article-thumb'></a>"+a}else{if(n.object.attachments[m].objectType=="video"){a="<img src='"+n.object.attachments[m].image.url+"' class='article-thumb'>"+a;a+="<div>";a+="<a href='"+n.object.attachments[m].url+"' target='_blank'>";a+="<h5>"+n.object.attachments[m].displayName+"</h5>";a+="</a>";a+="</div>"}else{if(n.object.attachments[m].objectType=="article"){a+="<div>";a+="<a href='"+n.object.attachments[m].url+"' target='_blank'>";a+="<h5>"+n.object.attachments[m].displayName+"</h5>";a+="<p>"+n.object.attachments[m].content+"</p>";a+="</a>";a+="</div>"}}}trace(n.object.attachments[m])}a="<div class='googleplus-attachments'>"+a+"</div>"}d="<div class='googleplus-content'>"+j+a+"</div>";d+="<div class='vcard author'><a class='screen-name url' href='"+n.url+"' target='_blank'>";d+="<span class='avatar'><img src='"+n.actor.image.url+"' style='max-width: 32px; max-height: 32px;'></span>";d+="<span class='fn'>"+n.actor.displayName+"</span>";d+="<span class='nickname'><span class='thumbnail-inline'></span></span>";d+="</a></div>";VMM.attachElement("#googleplus_"+e.activity,d)});break}}}).error(function(l,n,m){var k=VMM.parseJSON(l.responseText);trace(k.error.message);VMM.attachElement("#googleplus_"+e.activity,VMM.MediaElement.loadingmessage("<p>ERROR LOADING GOOGLE+ </p><p>"+k.error.message+"</p>"))}).success(function(k){clearTimeout(googleplus_timeout);clearTimeout(callback_timeout);g()})},pushQue:function(){if(VMM.master_config.googleplus.que.length>0){VMM.ExternalAPI.googleplus.create(VMM.master_config.googleplus.que[0],VMM.ExternalAPI.googleplus.pushQue);VMM.master_config.googleplus.que.remove(0)}},errorTimeOut:function(a){trace("GOOGLE+ JSON ERROR TIMEOUT "+a.activity);VMM.attachElement("#googleplus_"+a.activity,VMM.MediaElement.loadingmessage("<p>Still waiting on GOOGLE+ </p><p>"+a.activity+"</p>"))}},googledocs:{get:function(a){VMM.master_config.googledocs.que.push(a);VMM.master_config.googledocs.active=true},create:function(a){var b="";if(a.id.match(/docs.google.com/i)){b="<iframe class='doc' frameborder='0' width='100%' height='100%' src='"+a.id+"&amp;embedded=true'></iframe>"}else{b="<iframe class='doc' frameborder='0' width='100%' height='100%' src='http://docs.google.com/viewer?url="+a.id+"&amp;embedded=true'></iframe>"}VMM.attachElement("#"+a.uid,b)},pushQue:function(){for(var a=0;a<VMM.master_config.googledocs.que.length;a++){VMM.ExternalAPI.googledocs.create(VMM.master_config.googledocs.que[a])}VMM.master_config.googledocs.que=[]}},flickr:{get:function(a){VMM.master_config.flickr.que.push(a);VMM.master_config.flickr.active=true},create:function(b,e){var d,c=setTimeout(e,VMM.master_config.timers.api,b);if(typeof VMM.master_config.Timeline!="undefined"&&VMM.master_config.Timeline.api_keys.flickr!=""){d=VMM.master_config.Timeline.api_keys.flickr}else{d=Aes.Ctr.decrypt(VMM.master_config.api_keys_master.flickr,VMM.master_config.vp,256)}var a="http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+d+"&photo_id="+b.id+"&format=json&jsoncallback=?";VMM.getJSON(a,function(l){var m=l.sizes.size[0].url.split("photos/")[1].split("/")[1];var g="#"+b.uid,j="#"+b.uid+"_thumb";var o,n,k=false,f="Large";f=VMM.ExternalAPI.flickr.sizes(VMM.master_config.sizes.api.height);for(var h=0;h<l.sizes.size.length;h++){if(l.sizes.size[h].label==f){k=true;o=l.sizes.size[h].source}}if(!k){o=l.sizes.size[l.sizes.size.length-2].source}n=l.sizes.size[0].source;VMM.Lib.attr(g,"src",o);VMM.attachElement(j,"<img src='"+n+"'>")}).error(function(f,h,g){trace("FLICKR error");trace("FLICKR ERROR: "+h+" "+f.responseText)}).success(function(f){clearTimeout(c);e()})},pushQue:function(){if(VMM.master_config.flickr.que.length>0){VMM.ExternalAPI.flickr.create(VMM.master_config.flickr.que[0],VMM.ExternalAPI.flickr.pushQue);VMM.master_config.flickr.que.remove(0)}},sizes:function(b){var a="";if(b<=75){a="Thumbnail"}else{if(b<=180){a="Small"}else{if(b<=240){a="Small 320"}else{if(b<=375){a="Medium"}else{if(b<=480){a="Medium 640"}else{if(b<=600){a="Large"}else{a="Large"}}}}}}return a}},instagram:{get:function(a,b){if(b){return"http://instagr.am/p/"+a.id+"/media/?size=t"}else{return"http://instagr.am/p/"+a.id+"/media/?size="+VMM.ExternalAPI.instagram.sizes(VMM.master_config.sizes.api.height)}},sizes:function(b){var a="";if(b<=150){a="t"}else{if(b<=306){a="m"}else{a="l"}}return a}},soundcloud:{get:function(a){VMM.master_config.soundcloud.que.push(a);VMM.master_config.soundcloud.active=true},create:function(b,c){var a="http://soundcloud.com/oembed?url="+b.id+"&format=js&callback=?";VMM.getJSON(a,function(e){VMM.attachElement("#"+b.uid,e.html);c()})},pushQue:function(){if(VMM.master_config.soundcloud.que.length>0){VMM.ExternalAPI.soundcloud.create(VMM.master_config.soundcloud.que[0],VMM.ExternalAPI.soundcloud.pushQue);VMM.master_config.soundcloud.que.remove(0)}}},wikipedia:{get:function(a){VMM.master_config.wikipedia.que.push(a);VMM.master_config.wikipedia.active=true},create:function(b,d){var a="http://"+b.lang+".wikipedia.org/w/api.php?action=query&prop=extracts&redirects=&titles="+b.id+"&exintro=1&format=json&callback=?";callback_timeout=setTimeout(d,VMM.master_config.timers.api,b);if(VMM.Browser.browser=="Explorer"&&parseInt(VMM.Browser.version,10)>=7&&window.XDomainRequest){var c="<h4><a href='http://"+VMM.master_config.language.api.wikipedia+".wikipedia.org/wiki/"+b.id+"' target='_blank'>"+b.url+"</a></h4>";c+="<span class='wiki-source'>"+VMM.master_config.language.messages.wikipedia+"</span>";c+="<p>Wikipedia entry unable to load using Internet Explorer 8 or below.</p>";VMM.attachElement("#"+b.uid,c)}VMM.getJSON(a,function(m){if(m.query){var g,f,e="",l="",j=1,k=[];g=VMM.Util.getObjectAttributeByIndex(m.query.pages,0).extract;f=VMM.Util.getObjectAttributeByIndex(m.query.pages,0).title;if(g.match("<p>")){k=g.split("<p>")}else{k.push(g)}for(var h=0;h<k.length;h++){if(h+1<=j&&h+1<k.length){l+="<p>"+k[h+1]}}e="<h4><a href='http://"+VMM.master_config.language.api.wikipedia+".wikipedia.org/wiki/"+f+"' target='_blank'>"+f+"</a></h4>";e+="<span class='wiki-source'>"+VMM.master_config.language.messages.wikipedia+"</span>";e+=VMM.Util.linkify_wikipedia(l);if(g.match("REDIRECT")){}else{VMM.attachElement("#"+b.uid,e)}}}).error(function(e,g,f){trace("WIKIPEDIA error");trace("WIKIPEDIA ERROR: "+g+" "+e.responseText);trace(f);VMM.attachElement("#"+b.uid,VMM.MediaElement.loadingmessage("<p>Wikipedia is not responding</p>"));clearTimeout(callback_timeout);if(VMM.master_config.wikipedia.tries<4){trace("WIKIPEDIA ATTEMPT "+VMM.master_config.wikipedia.tries);trace(b);VMM.master_config.wikipedia.tries++;VMM.ExternalAPI.wikipedia.create(b,d)}else{d()}}).success(function(e){VMM.master_config.wikipedia.tries=0;clearTimeout(callback_timeout);d()})},pushQue:function(){if(VMM.master_config.wikipedia.que.length>0){trace("WIKIPEDIA PUSH QUE "+VMM.master_config.wikipedia.que.length);VMM.ExternalAPI.wikipedia.create(VMM.master_config.wikipedia.que[0],VMM.ExternalAPI.wikipedia.pushQue);VMM.master_config.wikipedia.que.remove(0)}}},youtube:{get:function(b){var a="http://gdata.youtube.com/feeds/api/videos/"+b.id+"?v=2&alt=jsonc&callback=?";VMM.master_config.youtube.que.push(b);if(!VMM.master_config.youtube.active){if(!VMM.master_config.youtube.api_loaded){LoadLib.js("http://www.youtube.com/player_api",function(){trace("YouTube API Library Loaded")})}}VMM.getJSON(a,function(c){VMM.ExternalAPI.youtube.createThumb(c,b)})},create:function(a){if(typeof(a.start)!="undefined"){var e=a.start.toString(),d=0,b=0;if(e.match("m")){d=parseInt(e.split("m")[0],10);b=parseInt(e.split("m")[1].split("s")[0],10);a.start=(d*60)+b}else{a.start=0}}else{a.start=0}var c={active:false,player:{},name:a.uid,playing:false,hd:false};if(typeof(a.hd)!="undefined"){c.hd=true}c.player[a.id]=new YT.Player(a.uid,{height:"390",width:"640",playerVars:{enablejsapi:1,color:"white",showinfo:0,theme:"light",start:a.start,rel:0},videoId:a.id,events:{onReady:VMM.ExternalAPI.youtube.onPlayerReady,onStateChange:VMM.ExternalAPI.youtube.onStateChange}});VMM.master_config.youtube.array.push(c)},createThumb:function(c,a){trace("CREATE THUMB");trace(c);trace(a);if(typeof c.data!="undefined"){var b="#"+a.uid+"_thumb";VMM.attachElement(b,"<img src='"+c.data.thumbnail.sqDefault+"'>")}},pushQue:function(){for(var a=0;a<VMM.master_config.youtube.que.length;a++){VMM.ExternalAPI.youtube.create(VMM.master_config.youtube.que[a])}VMM.master_config.youtube.que=[]},onAPIReady:function(){VMM.master_config.youtube.active=true;VMM.ExternalAPI.youtube.pushQue()},stopPlayers:function(){for(var a=0;a<VMM.master_config.youtube.array.length;a++){if(VMM.master_config.youtube.array[a].playing){var b=VMM.master_config.youtube.array[a].name;VMM.master_config.youtube.array[a].player[b].stopVideo()}}},onStateChange:function(b){for(var a=0;a<VMM.master_config.youtube.array.length;a++){var c=VMM.master_config.youtube.array[a].name;if(VMM.master_config.youtube.array[a].player[c]==b.target){if(b.data==YT.PlayerState.PLAYING){VMM.master_config.youtube.array[a].playing=true;trace(VMM.master_config.youtube.array[a].hd);if(VMM.master_config.youtube.array[a].hd){}}}}},onPlayerReady:function(a){}},vimeo:{get:function(a){VMM.master_config.vimeo.que.push(a);VMM.master_config.vimeo.active=true},create:function(a,d){trace("VIMEO CREATE");var b="http://vimeo.com/api/v2/video/"+a.id+".json",c="http://player.vimeo.com/video/"+a.id+"?title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff";VMM.getJSON(b,function(e){VMM.ExternalAPI.vimeo.createThumb(e,a);d()});VMM.attachElement("#"+a.uid,"<iframe autostart='false' frameborder='0' width='100%' height='100%' src='"+c+"'></iframe>")},createThumb:function(c,a){trace("VIMEO CREATE THUMB");var b="#"+a.uid+"_thumb";VMM.attachElement(b,"<img src='"+c[0].thumbnail_small+"'>")},pushQue:function(){if(VMM.master_config.vimeo.que.length>0){VMM.ExternalAPI.vimeo.create(VMM.master_config.vimeo.que[0],VMM.ExternalAPI.vimeo.pushQue);VMM.master_config.vimeo.que.remove(0)}}},webthumb:{get:function(a,b){VMM.master_config.webthumb.que.push(a);VMM.master_config.webthumb.active=true},sizes:function(b){var a="";if(b<=150){a="t"}else{if(b<=306){a="m"}else{a="l"}}return a},create:function(a){trace("WEB THUMB CREATE");var b="http://pagepeeker.com/t/";url=a.id.replace("http://","");VMM.attachElement("#"+a.uid,"<a href='"+a.id+"' target='_blank'><img src='"+b+"x/"+url+"'></a>");VMM.attachElement("#"+a.uid+"_thumb","<a href='"+a.id+"' target='_blank'><img src='"+b+"t/"+url+"'></a>")},pushQue:function(){for(var a=0;a<VMM.master_config.webthumb.que.length;a++){VMM.ExternalAPI.webthumb.create(VMM.master_config.webthumb.que[a])}VMM.master_config.webthumb.que=[]}}}).init()}function onYouTubePlayerAPIReady(){trace("GLOBAL YOUTUBE API CALLED");VMM.ExternalAPI.youtube.onAPIReady()}if(typeof VMM!="undefined"&&typeof VMM.MediaElement=="undefined"){VMM.MediaElement=({init:function(){return this},loadingmessage:function(a){return"<div class='vco-loading'><div class='vco-loading-container'><div class='vco-loading-icon'></div><div class='vco-message'><p>"+a+"</p></div></div></div>"},thumbnail:function(d,l,e,g){var k=16,c=24,j="";if(l!=null&&l!=""){k=l}if(e!=null&&e!=""){c=e}if(g!=null&&g!=""){j=g}if(d.media!=null&&d.media!=""){var a=true,f="",b=VMM.MediaType(d.media);if(d.thumbnail!=null&&d.thumbnail!=""){trace("CUSTOM THUMB");f="<div class='thumbnail thumb-custom' id='"+g+"_custom_thumb'><img src='"+d.thumbnail+"'></div>";return f}else{if(b.type=="image"){f="<div class='thumbnail thumb-photo'></div>";return f}else{if(b.type=="flickr"){f="<div class='thumbnail thumb-photo' id='"+g+"_thumb'></div>";return f}else{if(b.type=="instagram"){f="<div class='thumbnail thumb-instagram' id='"+g+"_thumb'><img src='"+VMM.ExternalAPI.instagram.get(b.id,true)+"'></div>";return f}else{if(b.type=="youtube"){f="<div class='thumbnail thumb-youtube' id='"+g+"_thumb'></div>";return f}else{if(b.type=="googledoc"){f="<div class='thumbnail thumb-document'></div>";return f}else{if(b.type=="vimeo"){f="<div class='thumbnail thumb-vimeo' id='"+g+"_thumb'></div>";return f}else{if(b.type=="dailymotion"){f="<div class='thumbnail thumb-video'></div>";return f}else{if(b.type=="twitter"){f="<div class='thumbnail thumb-twitter'></div>";return f}else{if(b.type=="twitter-ready"){f="<div class='thumbnail thumb-twitter'></div>";return f}else{if(b.type=="soundcloud"){f="<div class='thumbnail thumb-audio'></div>";return f}else{if(b.type=="google-map"){f="<div class='thumbnail thumb-map'></div>";return f}else{if(b.type=="googleplus"){f="<div class='thumbnail thumb-googleplus'></div>";return f}else{if(b.type=="wikipedia"){f="<div class='thumbnail thumb-wikipedia'></div>";return f}else{if(b.type=="storify"){f="<div class='thumbnail thumb-storify'></div>";return f}else{if(b.type=="quote"){f="<div class='thumbnail thumb-quote'></div>";return f}else{if(b.type=="unknown"){if(b.id.match("blockquote")){f="<div class='thumbnail thumb-quote'></div>"}else{f="<div class='thumbnail thumb-plaintext'></div>"}return f}else{if(b.type=="website"){f="<div class='thumbnail thumb-website' id='"+g+"_thumb'></div>";return f}else{f="<div class='thumbnail thumb-plaintext'></div>";return f}}}}}}}}}}}}}}}}}}}},create:function(d,f){var b=false,a=VMM.MediaElement.loadingmessage(VMM.master_config.language.messages.loading+"...");if(d.media!=null&&d.media!=""){var e="",h="",j="",k="",g=false,c;c=VMM.MediaType(d.media);c.uid=f;b=true;if(d.credit!=null&&d.credit!=""){j="<div class='credit'>"+VMM.Util.linkify_with_twitter(d.credit,"_blank")+"</div>"}if(d.caption!=null&&d.caption!=""){h="<div class='caption'>"+VMM.Util.linkify_with_twitter(d.caption,"_blank")+"</div>"}if(c.type=="image"){if(c.id.match("https://")){c.id=c.id.replace("https://","http://")}e="<div class='media-image media-shadow'><img src='"+c.id+"' class='media-image'></div>"}else{if(c.type=="flickr"){e="<div class='media-image media-shadow'><a href='"+c.link+"' target='_blank'><img id='"+f+"'></a></div>";VMM.ExternalAPI.flickr.get(c)}else{if(c.type=="instagram"){e="<div class='media-image media-shadow'><a href='"+c.link+"' target='_blank'><img src='"+VMM.ExternalAPI.instagram.get(c)+"'></a></div>"}else{if(c.type=="googledoc"){e="<div class='media-frame media-shadow doc' id='"+c.uid+"'>"+a+"</div>";VMM.ExternalAPI.googledocs.get(c)}else{if(c.type=="youtube"){e="<div class='media-shadow'><div class='media-frame video youtube' id='"+c.uid+"'>"+a+"</div></div>";VMM.ExternalAPI.youtube.get(c)}else{if(c.type=="vimeo"){e="<div class='media-shadow media-frame video vimeo' id='"+c.uid+"'>"+a+"</div>";VMM.ExternalAPI.vimeo.get(c)}else{if(c.type=="dailymotion"){e="<div class='media-shadow'><iframe class='media-frame video dailymotion' autostart='false' frameborder='0' width='100%' height='100%' src='http://www.dailymotion.com/embed/video/"+c.id+"'></iframe></div>"}else{if(c.type=="twitter"){e="<div class='twitter' id='"+c.uid+"'>"+a+"</div>";g=true;VMM.ExternalAPI.twitter.get(c)}else{if(c.type=="twitter-ready"){g=true;e=c.id}else{if(c.type=="soundcloud"){e="<div class='media-frame media-shadow soundcloud' id='"+c.uid+"'>"+a+"</div>";VMM.ExternalAPI.soundcloud.get(c)}else{if(c.type=="google-map"){e="<div class='media-frame media-shadow map' id='"+c.uid+"'>"+a+"</div>";VMM.ExternalAPI.googlemaps.get(c)}else{if(c.type=="googleplus"){k="googleplus_"+c.id;e="<div class='googleplus' id='"+k+"'>"+a+"</div>";g=true;VMM.ExternalAPI.googleplus.get(c)}else{if(c.type=="wikipedia"){e="<div class='wikipedia' id='"+c.uid+"'>"+a+"</div>";g=true;VMM.ExternalAPI.wikipedia.get(c)}else{if(c.type=="storify"){g=true;e="<div class='plain-text-quote'>"+c.id+"</div>"}else{if(c.type=="quote"){g=true;e="<div class='plain-text-quote'>"+c.id+"</div>"}else{if(c.type=="unknown"){trace("NO KNOWN MEDIA TYPE FOUND TRYING TO JUST PLACE THE HTML");g=true;e="<div class='plain-text'><div class='container'>"+VMM.Util.properQuotes(c.id)+"</div></div>"}else{if(c.type=="website"){e="<div class='media-shadow website' id='"+c.uid+"'>"+a+"</div>";VMM.ExternalAPI.webthumb.get(c)}else{trace("NO KNOWN MEDIA TYPE FOUND");trace(c.type)}}}}}}}}}}}}}}}}}e="<div class='media-container' >"+e+j+h+"</div>";if(g){return"<div class='text-media'><div class='media-wrapper'>"+e+"</div></div>"}else{return"<div class='media-wrapper'>"+e+"</div>"}}}}).init()}if(typeof VMM!="undefined"&&typeof VMM.MediaType=="undefined"){VMM.MediaType=function(a){var f=a.replace(/^\s\s*/,"").replace(/\s\s*$/,""),e=false,c={type:"unknown",id:"",start:0,hd:false,link:"",lang:VMM.Language.lang,uniqueid:VMM.Util.unique_ID(6)};if(f.match("div class='twitter'")){c.type="twitter-ready";c.id=f;e=true}else{if(f.match("(www.)?youtube|youtu.be")){if(f.match("v=")){c.id=VMM.Util.getUrlVars(f)["v"]}else{if(f.match("/embed/")){c.id=f.split("embed/")[1].split(/[?&]/)[0]}else{c.id=f.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0]}}c.start=VMM.Util.getUrlVars(f)["t"];c.hd=VMM.Util.getUrlVars(f)["hd"];c.type="youtube";e=true}else{if(f.match("(player.)?vimeo.com")){c.type="vimeo";c.id=f.split(/video\/|\/\/vimeo\.com\//)[1].split(/[?&]/)[0];e=true}else{if(f.match("(www.)?dailymotion.com")){c.id=f.split(/video\/|\/\/dailymotion\.com\//)[1];c.type="dailymotion";e=true}else{if(f.match("(player.)?soundcloud.com")){c.type="soundcloud";c.id=f;e=true}else{if(f.match("(www.)?twitter.com")&&f.match("status")){if(f.match("status/")){c.id=f.split("status/")[1]}else{if(f.match("statuses/")){c.id=f.split("statuses/")[1]}else{c.id=""}}c.type="twitter";e=true}else{if(f.match("maps.google")&&!f.match("staticmap")){c.type="google-map";c.id=f.split(/src=['|"][^'|"]*?['|"]/gi);e=true}else{if(f.match("plus.google")){c.type="googleplus";c.id=f.split("/posts/")[1];if(f.split("/posts/")[0].match("u/0/")){c.user=f.split("u/0/")[1].split("/posts")[0]}else{c.user=f.split("google.com/")[1].split("/posts/")[0]}e=true}else{if(f.match("flickr.com/photos")){c.type="flickr";c.id=f.split("photos/")[1].split("/")[1];c.link=f;e=true}else{if(f.match("instagr.am/p/")){c.type="instagram";c.link=f;c.id=f.split("/p/")[1].split("/")[0];e=true}else{if(f.match(/jpg|jpeg|png|gif/i)||f.match("staticmap")||f.match("yfrog.com")||f.match("twitpic.com")){c.type="image";c.id=f;e=true}else{if(VMM.FileExtention.googleDocType(f)){c.type="googledoc";c.id=f;e=true}else{if(f.match("(www.)?wikipedia.org")){c.type="wikipedia";var b=f.split("wiki/")[1].split("#")[0].replace("_"," ");c.id=b.replace(" ","%20");c.lang=f.split("//")[1].split(".wikipedia")[0];e=true}else{if(f.indexOf("http://")==0){c.type="website";c.id=f;e=true}else{if(f.match("storify")){c.type="storify";c.id=f;e=true}else{if(f.match("blockquote")){c.type="quote";c.id=f;e=true}else{trace("unknown media");c.type="unknown";c.id=f;e=true}}}}}}}}}}}}}}}}if(e){return c}else{trace("No valid media id detected");trace(f)}return false}}if(typeof VMM!="undefined"&&typeof VMM.TextElement=="undefined"){VMM.TextElement=({init:function(){return this},create:function(a){return a}}).init()}if(typeof VMM!="undefined"&&typeof VMM.DragSlider=="undefined"){VMM.DragSlider=function(){var j={element:"",element_move:"",constraint:"",sliding:false,pagex:{start:0,end:0},left:{start:0,end:0},time:{start:0,end:0},touch:false,ease:"easeOutExpo"},q={down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},l={down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},k={down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},p=this,a=false;this.createPanel=function(u,r,t,v,s){j.element=u;j.element_move=r;if(s!=null&&s!=""){a=s}if(t!=null&&t!=""){j.constraint=t}else{j.constraint=false}if(v){j.touch=v}else{j.touch=false}trace("TOUCH"+j.touch);if(j.touch){q=k}else{q=l}m(j.element,j.element_move)};this.updateConstraint=function(r){trace("updateConstraint");j.constraint=r};this.cancelSlide=function(r){VMM.unbindEvent(j.element,c,q.move);return true};function m(s,r){VMM.bindEvent(s,d,q.down,{element:r,delement:s});VMM.bindEvent(s,f,q.up,{element:r,delement:s});VMM.bindEvent(s,o,q.leave,{element:r,delement:s})}function o(r){VMM.unbindEvent(r.data.delement,c,q.move);if(!j.touch){r.preventDefault()}r.stopPropagation();if(j.sliding){j.sliding=false;e(r.data.element,r.data.delement,r);return false}else{return true}}function d(r){n(r.data.element,r.data.delement,r);if(!j.touch){r.preventDefault()}r.stopPropagation();return true}function f(r){if(!j.touch){r.preventDefault()}r.stopPropagation();if(j.sliding){j.sliding=false;e(r.data.element,r.data.delement,r);return false}else{return true}}function c(r){h(r.data.element,r);if(Math.abs(j.left.start)>g(elem)){}return false}function n(s,r,t){if(j.touch){trace("IS TOUCH");VMM.Lib.css(s,"-webkit-transition-duration","0");j.pagex.start=t.originalEvent.touches[0].screenX}else{j.pagex.start=t.pageX}j.left.start=g(s);j.time.start=new Date().getTime();VMM.Lib.stop(s);VMM.bindEvent(r,c,q.move,{element:s})}function e(s,r,t){VMM.unbindEvent(r,c,q.move);b(s,t)}function h(r,t){var s;j.sliding=true;if(j.touch){j.pagex.end=t.originalEvent.touches[0].screenX}else{j.pagex.end=t.pageX}j.left.end=g(r);s=-(j.pagex.start-j.pagex.end-j.left.start);if(Math.abs(s-j.left.start)>10){VMM.Lib.css(r,"left",s);t.preventDefault();t.stopPropagation()}}function b(s,t){var r={left:j.left.end,left_adjust:0,change:{x:0},time:(new Date().getTime()-j.time.start)*10,time_adjust:(new Date().getTime()-j.time.start)*10},u=3000;if(j.touch){u=6000}r.change.x=u*(Math.abs(j.pagex.end)-Math.abs(j.pagex.start));r.left_adjust=Math.round(r.change.x/r.time);r.left=Math.min(r.left+r.left_adjust);if(j.constraint){if(r.left>j.constraint.left){r.left=j.constraint.left;if(r.time>5000){r.time=5000}}else{if(r.left<j.constraint.right){r.left=j.constraint.right;if(r.time>5000){r.time=5000}}}}VMM.fireEvent(p,"DRAGUPDATE",[r]);if(!a){if(r.time>0){if(j.touch){VMM.Lib.animate(s,r.time,"easeOutCirc",{left:r.left})}else{VMM.Lib.animate(s,r.time,j.ease,{left:r.left})}}}}function g(r){return parseInt(VMM.Lib.css(r,"left").substring(0,VMM.Lib.css(r,"left").length-2),10)}}}if(typeof VMM!="undefined"&&typeof VMM.Slider=="undefined"){VMM.Slider=function(n,A){var K,H,o,F,k,t,v,G,E={},V=[],f=[],J=[],C="",Q=0,R=960,T={move:false,x:10,y:0,off:0,dampen:48},m="",c=false,I=n,s={nextBtn:"",prevBtn:"",nextDate:"",prevDate:"",nextTitle:"",prevTitle:""};if(typeof A!="undefined"){K=A}else{K={preload:4,current_slide:0,interval:10,something:0,width:720,height:400,ease:"easeInOutExpo",duration:1000,timeline:false,spacing:15,slider:{width:720,height:400,content:{width:720,height:400,padding:120,padding_default:120},nav:{width:100,height:200}}}}this.ver="0.6";K.slider.width=K.width;K.slider.height=K.height;this.init=function(W){f=[];J=[];if(typeof W!="undefined"){this.setData(W)}else{trace("WAITING ON DATA")}};this.width=function(W){if(W!=null&&W!=""){K.slider.width=W;l()}else{return K.slider.width}};this.height=function(W){if(W!=null&&W!=""){K.slider.height=W;l()}else{return K.slider.height}};this.setData=function(W){if(typeof W!="undefined"){V=W;M()}else{trace("NO DATA")}};this.getData=function(){return V};this.setConfig=function(W){if(typeof W!="undefined"){K=W}else{trace("NO CONFIG DATA")}};this.getConfig=function(){return K};this.setSize=function(W,X){if(W!=null){K.slider.width=W}if(X!=null){K.slider.height=X}if(c){l()}};this.active=function(){return c};this.getCurrentNumber=function(){return Q};this.setSlide=function(W){P(W)};function j(){trace("onConfigSet")}function l(Y,X){var W=true,Z=false;if(Y!=null){W=Y}if(X!=null){Z=X}R=K.slider.width;K.slider.nav.height=VMM.Lib.height(s.prevBtnContainer);if(VMM.Browser.device=="mobile"||R<=640){K.slider.content.padding=10}else{K.slider.content.padding=K.slider.content.padding_default}K.slider.content.width=R-(K.slider.content.padding*2);VMM.Lib.width(t,(f.length*K.slider.content.width));if(Z){VMM.Lib.css(k,"left",f[Q].leftpos())}b();L();VMM.Lib.css(s.nextBtn,"left",(R-K.slider.nav.width));VMM.Lib.height(s.prevBtn,K.slider.height);VMM.Lib.height(s.nextBtn,K.slider.height);VMM.Lib.css(s.nextBtnContainer,"top",((K.slider.height/2)-(K.slider.nav.height/2))+10);VMM.Lib.css(s.prevBtnContainer,"top",((K.slider.height/2)-(K.slider.nav.height/2))+10);VMM.Lib.height(F,K.slider.height);VMM.Lib.width(F,R);if(W){P(Q,"linear",1)}if(Q==0){VMM.Lib.visible(s.prevBtn,false)}}function e(W,X){trace("DRAG FINISH");trace(X.left_adjust);trace((K.slider.width/2));if(X.left_adjust<0){if(Math.abs(X.left_adjust)>(K.slider.width/2)){if(Q==f.length-1){q()}else{P(Q+1,"easeOutExpo");D()}}else{q()}}else{if(Math.abs(X.left_adjust)>(K.slider.width/2)){if(Q==0){q()}else{P(Q-1,"easeOutExpo");D()}}else{q()}}}function a(W){if(Q==f.length-1){q()}else{P(Q+1);D()}}function U(W){if(Q==0){q()}else{P(Q-1);D()}}function r(W){switch(W.keyCode){case 39:a(W);break;case 37:U(W);break}}function N(aa,X){if(J.length==0){for(var Z=0;Z<f.length;Z++){J.push(f[Z].leftpos())}}if(typeof X.left=="number"){var W=X.left;var Y=-(f[Q].leftpos());if(W<Y-(K.slider_width/3)){a()}else{if(W>Y+(K.slider_width/3)){U()}else{VMM.Lib.animate(k,K.duration,K.ease,{left:Y})}}}else{VMM.Lib.animate(k,K.duration,K.ease,{left:Y})}if(typeof X.top=="number"){VMM.Lib.animate(k,K.duration,K.ease,{top:-X.top})}else{}}function S(W){p()}function D(){K.current_slide=Q;VMM.fireEvent(I,"UPDATE")}function z(W){V=W}function g(Y){var W=0;VMM.attachElement(t,"");f=[];for(W=0;W<Y.length;W++){var X=new VMM.Slider.Slide(Y[W],t);f.push(X)}}function h(X){var W=0;if(X){u()}else{for(W=0;W<f.length;W++){f[W].clearTimers()}H=setTimeout(u,K.duration)}}function u(){var W=0;for(W=0;W<f.length;W++){f[W].enqueue=true}for(W=0;W<K.preload;W++){if(!((Q+W)>f.length-1)){f[Q+W].show();f[Q+W].enqueue=false}if(!((Q-W)<0)){f[Q-W].show();f[Q-W].enqueue=false}}if(f.length>50){for(W=0;W<f.length;W++){if(f[W].enqueue){f[W].hide()}}}b()}function y(W){}function b(){var Z=0,ab=".slider-item .layout-text-media .media .media-container ",W=".slider-item .layout-media .media .media-container ",aa=".slider-item .media .media-container",ac=".slider-item .media .media-container .media-shadow .caption",Y=false,X={text_media:{width:(K.slider.content.width/100)*60,height:K.slider.height-60,video:{width:0,height:0},text:{width:((K.slider.content.width/100)*40)-30,height:K.slider.height}},media:{width:K.slider.content.width,height:K.slider.height-110,video:{width:0,height:0}}};if(VMM.Browser.device=="mobile"||R<=640){Y=true}VMM.master_config.sizes.api.width=X.media.width;VMM.master_config.sizes.api.height=X.media.height;X.text_media.video=VMM.Util.ratio.fit(X.text_media.width,X.text_media.height,16,9);X.media.video=VMM.Util.ratio.fit(X.media.width,X.media.height,16,9);VMM.Lib.css(".slider-item","width",K.slider.content.width);VMM.Lib.height(".slider-item",K.slider.height);if(Y){X.text_media.width=K.slider.content.width-(K.slider.content.padding*2);X.media.width=K.slider.content.width-(K.slider.content.padding*2);X.text_media.height=((K.slider.height/100)*50)-50;X.media.height=((K.slider.height/100)*70)-40;X.text_media.video=VMM.Util.ratio.fit(X.text_media.width,X.text_media.height,16,9);X.media.video=VMM.Util.ratio.fit(X.media.width,X.media.height,16,9);VMM.Lib.css(".slider-item .layout-text-media .text","width","100%");VMM.Lib.css(".slider-item .layout-text-media .text","display","block");VMM.Lib.css(".slider-item .layout-text-media .text .container","display","block");VMM.Lib.css(".slider-item .layout-text-media .text .container","width",X.media.width);VMM.Lib.css(".slider-item .layout-text-media .text .container .start","width","auto");VMM.Lib.css(".slider-item .layout-text-media .media","float","none");VMM.Lib.addClass(".slider-item .content-container","pad-top");VMM.Lib.css(".slider-item .media blockquote p","line-height","18px");VMM.Lib.css(".slider-item .media blockquote p","font-size","16px");VMM.Lib.css(".slider-item","overflow-y","auto")}else{VMM.Lib.css(".slider-item .layout-text-media .text","width","40%");VMM.Lib.css(".slider-item .layout-text-media .text","display","table-cell");VMM.Lib.css(".slider-item .layout-text-media .text .container","display","table-cell");VMM.Lib.css(".slider-item .layout-text-media .text .container","width","auto");VMM.Lib.css(".slider-item .layout-text-media .text .container .start","width",X.text_media.text.width);VMM.Lib.removeClass(".slider-item .content-container","pad-top");VMM.Lib.css(".slider-item .layout-text-media .media","float","left");VMM.Lib.css(".slider-item .layout-text-media","display","table");VMM.Lib.css(".slider-item .media blockquote p","line-height","36px");VMM.Lib.css(".slider-item .media blockquote p","font-size","28px");VMM.Lib.css(".slider-item","display","table");VMM.Lib.css(".slider-item","overflow-y","auto")}VMM.Lib.css(ab+".media-frame","max-width",X.text_media.width);VMM.Lib.height(ab+".media-frame",X.text_media.height);VMM.Lib.width(ab+".media-frame",X.text_media.width);VMM.Lib.css(ab+"img","max-height",X.text_media.height);VMM.Lib.css(W+"img","max-height",X.media.height);VMM.Lib.css(ab+"img","max-width",X.text_media.width);VMM.Lib.css(ab+".avatar img","max-width",32);VMM.Lib.css(ab+".avatar img","max-height",32);VMM.Lib.css(W+".avatar img","max-width",32);VMM.Lib.css(W+".avatar img","max-height",32);VMM.Lib.css(ab+".article-thumb","max-width","50%");VMM.Lib.css(W+".article-thumb","max-width",200);VMM.Lib.width(ab+".media-frame",X.text_media.video.width);VMM.Lib.height(ab+".media-frame",X.text_media.video.height);VMM.Lib.width(W+".media-frame",X.media.video.width);VMM.Lib.height(W+".media-frame",X.media.video.height);VMM.Lib.css(W+".media-frame","max-height",X.media.video.height);VMM.Lib.css(W+".media-frame","max-width",X.media.video.width);VMM.Lib.height(W+".soundcloud",168);VMM.Lib.height(ab+".soundcloud",168);VMM.Lib.width(W+".soundcloud",X.media.width);VMM.Lib.width(ab+".soundcloud",X.text_media.width);VMM.Lib.css(aa+".soundcloud","max-height",168);VMM.Lib.height(ab+".map",X.text_media.height);VMM.Lib.width(ab+".map",X.text_media.width);VMM.Lib.css(W+".map","max-height",X.media.height);VMM.Lib.width(W+".map",X.media.width);VMM.Lib.height(ab+".doc",X.text_media.height);VMM.Lib.width(ab+".doc",X.text_media.width);VMM.Lib.height(W+".doc",X.media.height);VMM.Lib.width(W+".doc",X.media.width);VMM.Lib.width(W+".wikipedia",X.media.width);VMM.Lib.width(W+".twitter",X.media.width);VMM.Lib.width(W+".plain-text-quote",X.media.width);VMM.Lib.width(W+".plain-text",X.media.width);VMM.Lib.css(aa,"max-width",X.media.width);VMM.Lib.css(ab+".caption","max-width",X.text_media.video.width);VMM.Lib.css(W+".caption","max-width",X.media.video.width);for(Z=0;Z<f.length;Z++){f[Z].layout(Y);if(f[Z].content_height()>K.slider.height+20){f[Z].css("display","block")}else{f[Z].css("display","table")}}}var L=function(){var X=0,W=0;for(W=0;W<f.length;W++){X=W*(K.slider.width+K.spacing);f[W].leftpos(X)}};var O=function(Y){var X="linear",W=0;for(W=0;W<f.length;W++){if(W==Q){f[W].animate(K.duration,X,{opacity:1})}else{if(W==Q-1||W==Q+1){f[W].animate(K.duration,X,{opacity:0.1})}else{f[W].opacity(Y)}}}};function P(Y,ab,ac,ae,af){var W=K.ease,ad=K.duration,ag=false,Z=false,ai="",ah;VMM.ExternalAPI.youtube.stopPlayers();Q=Y;ah=f[Q].leftpos();if(Q==0){Z=true}if(Q+1>=f.length){ag=true}if(ab!=null&&ab!=""){W=ab}if(ac!=null&&ac!=""){ad=ac}if(VMM.Browser.device=="mobile"){VMM.Lib.visible(s.prevBtn,false);VMM.Lib.visible(s.nextBtn,false)}else{if(Z){VMM.Lib.visible(s.prevBtn,false)}else{VMM.Lib.visible(s.prevBtn,true);ai=VMM.Util.unlinkify(V[Q-1].title);if(K.type=="timeline"){if(typeof V[Q-1].date==="undefined"){VMM.attachElement(s.prevDate,ai);VMM.attachElement(s.prevTitle,"")}else{VMM.attachElement(s.prevDate,VMM.Date.prettyDate(V[Q-1].startdate));VMM.attachElement(s.prevTitle,ai)}}else{VMM.attachElement(s.prevTitle,ai)}}if(ag){VMM.Lib.visible(s.nextBtn,false)}else{VMM.Lib.visible(s.nextBtn,true);ai=VMM.Util.unlinkify(V[Q+1].title);if(K.type=="timeline"){if(typeof V[Q+1].date==="undefined"){VMM.attachElement(s.nextDate,ai);VMM.attachElement(s.nextTitle,"")}else{VMM.attachElement(s.nextDate,VMM.Date.prettyDate(V[Q+1].startdate));VMM.attachElement(s.nextTitle,ai)}}else{VMM.attachElement(s.nextTitle,ai)}}}if(ae){VMM.Lib.css(k,"left",-(ah-K.slider.content.padding))}else{VMM.Lib.stop(k);VMM.Lib.animate(k,ad,W,{left:-(ah-K.slider.content.padding)})}if(af){VMM.fireEvent(I,"LOADED")}if(f[Q].height()>K.slider_height){VMM.Lib.css(".slider","overflow-y","scroll")}else{VMM.Lib.css(I,"overflow-y","hidden");var X=0;try{X=VMM.Lib.prop(I,"scrollHeight");VMM.Lib.animate(I,ad,W,{scrollTop:X-VMM.Lib.height(I)})}catch(aa){X=VMM.Lib.height(I)}}h();VMM.fireEvent(o,"MESSAGE","TEST")}function q(){VMM.Lib.stop(k);VMM.Lib.animate(k,K.duration,"easeOutExpo",{left:-(f[Q].leftpos())+K.slider.content.padding})}function d(X,Y,W){trace("showMessege "+Y);VMM.attachElement(G,"<div class='vco-explainer'><div class='vco-explainer-container'><div class='vco-bezel'><div class='vco-gesture-icon'></div><div class='vco-message'><p>"+Y+"</p></div></div></div></div>")}function w(){VMM.Lib.animate(G,K.duration,K.ease,{opacity:0},p)}function p(){VMM.Lib.detach(G)}function B(){var W="<div class='icon'>&nbsp;</div>";s.nextBtn=VMM.appendAndGetElement(o,"<div>","nav-next");s.prevBtn=VMM.appendAndGetElement(o,"<div>","nav-previous");s.nextBtnContainer=VMM.appendAndGetElement(s.nextBtn,"<div>","nav-container",W);s.prevBtnContainer=VMM.appendAndGetElement(s.prevBtn,"<div>","nav-container",W);if(K.type=="timeline"){s.nextDate=VMM.appendAndGetElement(s.nextBtnContainer,"<div>","date","");s.prevDate=VMM.appendAndGetElement(s.prevBtnContainer,"<div>","date","")}s.nextTitle=VMM.appendAndGetElement(s.nextBtnContainer,"<div>","title","");s.prevTitle=VMM.appendAndGetElement(s.prevBtnContainer,"<div>","title","");VMM.bindEvent(".nav-next",a);VMM.bindEvent(".nav-previous",U);VMM.bindEvent(window,r,"keydown")}function M(){var W=3000;VMM.attachElement(I,"");o=VMM.getElement(I);F=VMM.appendAndGetElement(o,"<div>","slider-container-mask");k=VMM.appendAndGetElement(F,"<div>","slider-container");t=VMM.appendAndGetElement(k,"<div>","slider-item-container");B();g(V);if(VMM.Browser.device=="tablet"||VMM.Browser.device=="mobile"){K.duration=500;W=1000;v=new VMM.DragSlider();v.createPanel(o,k,"",K.touch,true);VMM.bindEvent(v,e,"DRAGUPDATE");G=VMM.appendAndGetElement(F,"<div>","vco-feedback","");d(null,"Swipe to Navigate");VMM.Lib.height(G,K.slider.height);VMM.bindEvent(G,S)}l(false,true);VMM.Lib.visible(s.prevBtn,false);P(K.current_slide,"easeOutExpo",W,true,true);c=true}}}if(typeof VMM.Slider!="undefined"){VMM.Slider.Slide=function(w,u){var z,s,q,r,f,y,B=w,a={},f="",l="",t=false,b=false,m=false,g=true,k=false,h="slide_",p={pushque:"",render:"",relayout:"",remove:"",skinny:false},o={pushque:500,render:100,relayout:100,remove:30000};h=h+B.uniqueid;this.enqueue=g;this.id=h;f=VMM.appendAndGetElement(u,"<div>","slider-item");y={slide:"",text:"",media:"",media_element:"",layout:"content-container layout",has:{headline:false,text:false,media:false}};this.show=function(c){g=false;p.skinny=c;k=false;clearTimeout(p.remove);if(!t){if(b){clearTimeout(p.relayout);p.relayout=setTimeout(v,o.relayout)}else{A(c)}}};this.hide=function(){if(t&&!k){k=true;clearTimeout(p.remove);p.remove=setTimeout(e,o.remove)}};this.clearTimers=function(){clearTimeout(p.relayout);clearTimeout(p.pushque);clearTimeout(p.render)};this.layout=function(c){if(t&&b){j(c)}};this.elem=function(){return f};this.position=function(){return VMM.Lib.position(f)};this.leftpos=function(c){if(typeof c!="undefined"){VMM.Lib.css(f,"left",c)}else{return VMM.Lib.position(f).left}};this.animate=function(D,C,c){VMM.Lib.animate(f,D,C,c)};this.css=function(d,c){VMM.Lib.css(f,d,c)};this.opacity=function(c){VMM.Lib.css(f,"opacity",c)};this.width=function(){return VMM.Lib.width(f)};this.height=function(){return VMM.Lib.height(f)};this.content_height=function(){var c=VMM.Lib.find(f,".content")[0];if(c!="undefined"&&c!=null){return VMM.Lib.height(c)}else{return 0}};var A=function(c){trace("RENDER "+h);t=true;b=true;p.skinny=c;n();clearTimeout(p.pushque);clearTimeout(p.render);p.pushque=setTimeout(VMM.ExternalAPI.pushQues,o.pushque)};var e=function(){trace("REMOVE SLIDE TIMER FINISHED");t=false;VMM.Lib.detach(s);VMM.Lib.detach(z)};var v=function(){t=true;j(p.skinny,true)};var j=function(c,d){if(y.has.text){if(c){if(!m||d){VMM.Lib.removeClass(q,"pad-left");VMM.Lib.detach(s);VMM.Lib.detach(z);VMM.Lib.append(q,s);VMM.Lib.append(q,z);m=true}}else{if(m||d){VMM.Lib.addClass(q,"pad-left");VMM.Lib.detach(s);VMM.Lib.detach(z);VMM.Lib.append(q,z);VMM.Lib.append(q,s);m=false}}}else{if(d){if(y.has.headline){VMM.Lib.detach(s);VMM.Lib.append(q,s)}VMM.Lib.detach(z);VMM.Lib.append(q,z)}}};var n=function(){trace("BUILDSLIDE");r=VMM.appendAndGetElement(f,"<div>","content");q=VMM.appendAndGetElement(r,"<div>");if(B.startdate!=null&&B.startdate!=""){if(type.of(B.startdate)=="date"){if(B.type!="start"){var C=VMM.Date.prettyDate(B.startdate);var d=VMM.Date.prettyDate(B.enddate);var c="";if(B.tag!=null&&B.tag!=""){c=VMM.createElement("span",B.tag,"slide-tag")}if(C!=d){y.text+=VMM.createElement("h2",C+" &mdash; "+d+c,"date")}else{y.text+=VMM.createElement("h2",C+c,"date")}}}}if(B.headline!=null&&B.headline!=""){y.has.headline=true;if(B.type=="start"){y.text+=VMM.createElement("h2",VMM.Util.linkify_with_twitter(B.headline,"_blank"),"start")}else{y.text+=VMM.createElement("h3",VMM.Util.linkify_with_twitter(B.headline,"_blank"))}}if(B.text!=null&&B.text!=""){y.has.text=true;y.text+=VMM.createElement("p",VMM.Util.linkify_with_twitter(B.text,"_blank"))}if(y.has.text||y.has.headline){y.text=VMM.createElement("div",y.text,"container");s=VMM.appendAndGetElement(q,"<div>","text",VMM.TextElement.create(y.text))}if(B.needs_slug){}if(B.asset!=null&&B.asset!=""){if(B.asset.media!=null&&B.asset.media!=""){y.has.media=true;z=VMM.appendAndGetElement(q,"<div>","media",VMM.MediaElement.create(B.asset,B.uniqueid))}}if(y.has.text){y.layout+="-text"}if(y.has.media){y.layout+="-media"}if(y.has.text){if(p.skinny){VMM.Lib.addClass(q,y.layout);m=true}else{VMM.Lib.addClass(q,y.layout);VMM.Lib.addClass(q,"pad-left");VMM.Lib.detach(s);VMM.Lib.append(q,s)}}else{VMM.Lib.addClass(q,y.layout)}}}}var Aes={};Aes.cipher=function(e,a){var d=4;var h=a.length/d-1;var g=[[],[],[],[]];for(var f=0;f<4*d;f++){g[f%4][Math.floor(f/4)]=e[f]}g=Aes.addRoundKey(g,a,0,d);for(var c=1;c<h;c++){g=Aes.subBytes(g,d);g=Aes.shiftRows(g,d);g=Aes.mixColumns(g,d);g=Aes.addRoundKey(g,a,c,d)}g=Aes.subBytes(g,d);g=Aes.shiftRows(g,d);g=Aes.addRoundKey(g,a,h,d);var b=new Array(4*d);for(var f=0;f<4*d;f++){b[f]=g[f%4][Math.floor(f/4)]}return b};Aes.keyExpansion=function(f){var d=4;var b=f.length/4;var g=b+6;var e=new Array(d*(g+1));var h=new Array(4);for(var c=0;c<b;c++){var a=[f[4*c],f[4*c+1],f[4*c+2],f[4*c+3]];e[c]=a}for(var c=b;c<(d*(g+1));c++){e[c]=new Array(4);for(var j=0;j<4;j++){h[j]=e[c-1][j]}if(c%b==0){h=Aes.subWord(Aes.rotWord(h));for(var j=0;j<4;j++){h[j]^=Aes.rCon[c/b][j]}}else{if(b>6&&c%b==4){h=Aes.subWord(h)}}for(var j=0;j<4;j++){e[c][j]=e[c-b][j]^h[j]}}return e};Aes.subBytes=function(b,a){for(var d=0;d<4;d++){for(var e=0;e<a;e++){b[d][e]=Aes.sBox[b[d][e]]}}return b};Aes.shiftRows=function(d,a){var b=new Array(4);for(var e=1;e<4;e++){for(var f=0;f<4;f++){b[f]=d[e][(f+e)%a]}for(var f=0;f<4;f++){d[e][f]=b[f]}}return d};Aes.mixColumns=function(h,f){for(var j=0;j<4;j++){var e=new Array(4);var d=new Array(4);for(var g=0;g<4;g++){e[g]=h[g][j];d[g]=h[g][j]&128?h[g][j]<<1^283:h[g][j]<<1}h[0][j]=d[0]^e[1]^d[1]^e[2]^e[3];h[1][j]=e[0]^d[1]^e[2]^d[2]^e[3];h[2][j]=e[0]^e[1]^d[2]^e[3]^d[3];h[3][j]=e[0]^d[0]^e[1]^e[2]^d[3]}return h};Aes.addRoundKey=function(f,a,d,b){for(var e=0;e<4;e++){for(var g=0;g<b;g++){f[e][g]^=a[d*4+g][e]}}return f};Aes.subWord=function(a){for(var b=0;b<4;b++){a[b]=Aes.sBox[a[b]]}return a};Aes.rotWord=function(a){var c=a[0];for(var b=0;b<3;b++){a[b]=a[b+1]}a[3]=c;return a};Aes.sBox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];Aes.rCon=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];Aes.Ctr={};Aes.Ctr.encrypt=function(j,a,u){var k=16;if(!(u==128||u==192||u==256)){return""}j=Utf8.encode(j);a=Utf8.encode(a);var l=u/8;var f=new Array(l);for(var s=0;s<l;s++){f[s]=isNaN(a.charCodeAt(s))?0:a.charCodeAt(s)}var A=Aes.cipher(f,Aes.keyExpansion(f));A=A.concat(A.slice(0,l-16));var e=new Array(k);var t=(new Date()).getTime();var g=t%1000;var d=Math.floor(t/1000);var p=Math.floor(Math.random()*65535);for(var s=0;s<2;s++){e[s]=(g>>>s*8)&255}for(var s=0;s<2;s++){e[s+2]=(p>>>s*8)&255}for(var s=0;s<4;s++){e[s+4]=(d>>>s*8)&255}var n="";for(var s=0;s<8;s++){n+=String.fromCharCode(e[s])}var w=Aes.keyExpansion(A);var r=Math.ceil(j.length/k);var m=new Array(r);for(var y=0;y<r;y++){for(var v=0;v<4;v++){e[15-v]=(y>>>v*8)&255}for(var v=0;v<4;v++){e[15-v-4]=(y/4294967296>>>v*8)}var h=Aes.cipher(e,w);var q=y<r-1?k:(j.length-1)%k+1;var o=new Array(q);for(var s=0;s<q;s++){o[s]=h[s]^j.charCodeAt(y*k+s);o[s]=String.fromCharCode(o[s])}m[y]=o.join("")}var z=n+m.join("");z=Base64.encode(z);return z};Aes.Ctr.decrypt=function(t,e,p){var m=16;if(!(p==128||p==192||p==256)){return""}t=Base64.decode(t);e=Utf8.encode(e);var n=p/8;var j=new Array(n);for(var o=0;o<n;o++){j[o]=isNaN(e.charCodeAt(o))?0:e.charCodeAt(o)}var u=Aes.cipher(j,Aes.keyExpansion(j));u=u.concat(u.slice(0,n-16));var f=new Array(8);ctrTxt=t.slice(0,8);for(var o=0;o<8;o++){f[o]=ctrTxt.charCodeAt(o)}var r=Aes.keyExpansion(u);var g=Math.ceil((t.length-8)/m);var h=new Array(g);for(var s=0;s<g;s++){h[s]=t.slice(8+s*m,8+s*m+m)}t=h;var a=new Array(t.length);for(var s=0;s<g;s++){for(var q=0;q<4;q++){f[15-q]=((s)>>>q*8)&255}for(var q=0;q<4;q++){f[15-q-4]=(((s+1)/4294967296-1)>>>q*8)&255}var l=Aes.cipher(f,r);var d=new Array(t[s].length);for(var o=0;o<t[s].length;o++){d[o]=l[o]^t[s].charCodeAt(o);d[o]=String.fromCharCode(d[o])}a[s]=d.join("")}var k=a.join("");k=Utf8.decode(k);return k};var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Base64.encode=function(o,q){q=(typeof q=="undefined")?false:q;var g,b,a,s,p,l,k,h,j=[],f="",n,r,m;var d=Base64.code;r=q?o.encodeUTF8():o;n=r.length%3;if(n>0){while(n++<3){f+="=";r+="\0"}}for(n=0;n<r.length;n+=3){g=r.charCodeAt(n);b=r.charCodeAt(n+1);a=r.charCodeAt(n+2);s=g<<16|b<<8|a;p=s>>18&63;l=s>>12&63;k=s>>6&63;h=s&63;j[n/3]=d.charAt(p)+d.charAt(l)+d.charAt(k)+d.charAt(h)}m=j.join("");m=m.slice(0,m.length-f.length)+f;return m};Base64.decode=function(o,e){e=(typeof e=="undefined")?false:e;var g,b,a,p,l,j,h,r,k=[],q,n;var f=Base64.code;n=e?o.decodeUTF8():o;for(var m=0;m<n.length;m+=4){p=f.indexOf(n.charAt(m));l=f.indexOf(n.charAt(m+1));j=f.indexOf(n.charAt(m+2));h=f.indexOf(n.charAt(m+3));r=p<<18|l<<12|j<<6|h;g=r>>>16&255;b=r>>>8&255;a=r&255;k[m/4]=String.fromCharCode(g,b,a);if(h==64){k[m/4]=String.fromCharCode(g,b)}if(j==64){k[m/4]=String.fromCharCode(g)}}q=k.join("");return e?q.decodeUTF8():q};var Utf8={};Utf8.encode=function(a){var b=a.replace(/[\u0080-\u07ff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(192|d>>6,128|d&63)});b=b.replace(/[\u0800-\uffff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(224|d>>12,128|d>>6&63,128|d&63)});return b};Utf8.decode=function(b){var a=b.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var d=((e.charCodeAt(0)&15)<<12)|((e.charCodeAt(1)&63)<<6)|(e.charCodeAt(2)&63);return String.fromCharCode(d)});a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var d=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(d)});return a};!function(b){var a=function(d,c){this.init("tooltip",d,c)};a.prototype={constructor:a,init:function(f,e,d){var g,c;this.type=f;this.$element=b(e);this.options=this.getOptions(d);this.enabled=true;if(this.options.trigger!="manual"){g=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(g,this.options.selector,b.proxy(this.enter,this));this.$element.on(c,this.options.selector,b.proxy(this.leave,this))}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){c.show()}else{c.hoverState="in";setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)}},leave:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.hide){c.hide()}else{c.hoverState="out";setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)}},show:function(){var g,c,j,e,h,d,f;if(this.hasContent()&&this.enabled){g=this.tip();this.setContent();if(this.options.animation){g.addClass("fade")}d=typeof this.options.placement=="function"?this.options.placement.call(this,g[0],this.$element[0]):this.options.placement;c=/in/.test(d);g.remove().css({top:0,left:0,display:"block"}).appendTo(c?this.$element:document.body);j=this.getPosition(c);e=g[0].offsetWidth;h=g[0].offsetHeight;switch(c?d.split(" ")[1]:d){case"bottom":f={top:j.top+j.height,left:j.left+j.width/2-e/2};break;case"top":f={top:j.top-h,left:j.left+j.width/2-e/2};break;case"left":f={top:j.top+j.height/2-h/2,left:j.left-e};break;case"right":f={top:j.top+j.height/2-h/2,left:j.left+j.width};break}g.css(f).addClass(d).addClass("in")}},setContent:function(){var c=this.tip();c.find(".tooltip-inner").html(this.getTitle());c.removeClass("fade in top bottom left right")},hide:function(){var c=this,d=this.tip();d.removeClass("in");function e(){var f=setTimeout(function(){d.off(b.support.transition.end).remove()},500);d.one(b.support.transition.end,function(){clearTimeout(f);d.remove()})}b.support.transition&&this.$tip.hasClass("fade")?e():d.remove()},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,c=this.$element,d=this.options;e=c.attr("data-original-title")||(typeof d.title=="function"?d.title.call(c[0]):d.title);e=e.toString().replace(/(^\s*|\s*$)/,"");return e},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};b.fn.tooltip=function(c){return this.each(function(){var f=b(this),e=f.data("tooltip"),d=typeof c=="object"&&c;if(!e){f.data("tooltip",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,delay:0,selector:false,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery);if(typeof VMM!="undefined"&&typeof VMM.StoryJS=="undefined"){VMM.StoryJS=function(){this.init=function(a){}}}if(typeof VMM!="undefined"&&typeof VMM.Timeline=="undefined"){VMM.Timeline=function(D,M,U){var G,e,B,T,p,a,g,C,V="2.x",r="#timelinejs",F={},W={},R=[],L={},o=false,j=false,s=false,f=false;if(type.of(D)=="string"){if(D.match("#")){r=D}else{r="#"+D}}else{r="#timelinejs"}L={embed:false,events:{data_ready:"DATAREADY",messege:"MESSEGE",headline:"HEADLINE",slide_change:"SLIDE_CHANGE",resize:"resize"},id:r,source:"nothing",type:"timeline",touch:false,orientation:"normal",maptype:"toner",version:"2.x",preload:4,current_slide:0,hash_bookmark:false,start_at_end:false,start_at_slide:0,start_zoom_adjust:0,start_page:false,api_keys:{google:"",flickr:"",twitter:""},interval:10,something:0,width:960,height:540,spacing:15,loaded:{slider:false,timenav:false,percentloaded:0},nav:{start_page:false,interval_width:200,density:4,minor_width:0,minor_left:0,constraint:{left:0,right:0,right_min:0,right_max:0},zoom:{adjust:0},multiplier:{current:6,min:0.1,max:50},rows:[1,1,1],width:960,height:200,marker:{width:150,height:50}},feature:{width:960,height:540},slider:{width:720,height:400,content:{width:720,height:400,padding:130,padding_default:130},nav:{width:100,height:200}},ease:"easeInOutExpo",duration:1000,gmap_key:"",language:VMM.Language};if(M!=null&&M!=""){L.width=M;o=true}if(U!=null&&U!=""){L.height=U;j=true}if(window.location.hash){var P=window.location.hash.substring(1);if(!isNaN(P)){L.current_slide=parseInt(P)}}window.onhashchange=function(){var h=window.location.hash.substring(1);if(L.hash_bookmark){if(f){O(parseInt(h))}else{f=false}}else{O(parseInt(h))}};function X(h){if(typeof embed_config=="object"){timeline_config=embed_config}if(typeof timeline_config=="object"){trace("HAS TIMELINE CONFIG");L=VMM.Util.mergeConfig(L,timeline_config)}else{if(typeof h=="object"){L=VMM.Util.mergeConfig(L,h)}}if(VMM.Browser.device=="mobile"||VMM.Browser.device=="tablet"){L.touch=true}L.nav.width=L.width;L.nav.height=200;L.feature.width=L.width;L.feature.height=L.height-L.nav.height;L.nav.zoom.adjust=parseInt(L.start_zoom_adjust,10);VMM.Timeline.Config=L;VMM.master_config.Timeline=VMM.Timeline.Config;this.events=L.events;if(L.gmap_key!=""){L.api_keys.google=L.gmap_key}trace("VERSION "+L.version);V=L.version}function m(){G=VMM.getElement(r);VMM.Lib.addClass(G,"vco-timeline");VMM.Lib.addClass(G,"vco-storyjs");e=VMM.appendAndGetElement(G,"<div>","vco-container vco-main");B=VMM.appendAndGetElement(e,"<div>","vco-feature");p=VMM.appendAndGetElement(B,"<div>","vco-slider");a=VMM.appendAndGetElement(e,"<div>","vco-navigation");T=VMM.appendAndGetElement(G,"<div>","vco-feedback","");if(typeof L.language.right_to_left!="undefined"){VMM.Lib.addClass(G,"vco-right-to-left")}g=new VMM.Slider(p,L);C=new VMM.Timeline.TimeNav(a);if(!o){L.width=VMM.Lib.width(G)}else{VMM.Lib.width(G,L.width)}if(!j){L.height=VMM.Lib.height(G)}else{VMM.Lib.height(G,L.height)}if(L.touch){VMM.Lib.addClass(G,"vco-touch")}else{VMM.Lib.addClass(G,"vco-notouch")}}function d(h,w){trace("onDataReady");W=w.timeline;if(type.of(W.era)!="array"){W.era=[]}S()}function I(){N()}function n(){t();g.setSize(L.feature.width,L.feature.height);C.setSize(L.width,L.height);if(l()){Q()}}function H(h){L.loaded.slider=true;k()}function k(h){L.loaded.percentloaded=L.loaded.percentloaded+25;if(L.loaded.slider&&L.loaded.timenav){z()}}function u(h){L.loaded.timenav=true;k()}function K(h){f=true;L.current_slide=g.getCurrentNumber();y(L.current_slide);C.setMarker(L.current_slide,L.ease,L.duration)}function E(h){f=true;L.current_slide=C.getCurrentNumber();y(L.current_slide);g.setSlide(L.current_slide)}function O(h){if(h<=R.length-1&&h>=0){L.current_slide=h;g.setSlide(L.current_slide);C.setMarker(L.current_slide,L.ease,L.duration)}}function y(h){if(L.hash_bookmark){window.location.hash="#"+h.toString()}}function J(){}function Q(){var h="",w=c(window.orientation);if(VMM.Browser.device=="mobile"){if(w=="portrait"){h="width=device-width; initial-scale=0.5, maximum-scale=0.5"}else{if(w=="landscape"){h="width=device-width; initial-scale=0.5, maximum-scale=0.5"}else{h="width=device-width, initial-scale=1, maximum-scale=1.0"}}}else{if(VMM.Browser.device=="tablet"){}}if(document.getElementById("viewport")){}else{}}function c(h){var w="";if(h==0||h==180){w="portrait"}else{if(h==90||h==-90){w="landscape"}else{w="normal"}}return w}function l(){var h=c(window.orientation);if(h==L.orientation){return false}else{L.orientation=h;return true}}this.init=function(w,h){trace("INIT");Q();X(w);m();if(type.of(h)=="string"){L.source=h}VMM.Date.setLanguage(L.language);VMM.master_config.language=L.language;VMM.ExternalAPI.setKeys(L.api_keys);VMM.ExternalAPI.googlemaps.setMapType(L.maptype);VMM.bindEvent(global,d,L.events.data_ready);VMM.bindEvent(global,b,L.events.messege);VMM.fireEvent(global,L.events.messege,L.language.messages.loading_timeline);if(VMM.Browser.browser=="Explorer"||VMM.Browser.browser=="MSIE"){if(parseInt(VMM.Browser.version,10)<=7){s=true}}if(type.of(L.source)=="string"||type.of(L.source)=="object"){VMM.Timeline.DataObj.getData(L.source)}else{VMM.fireEvent(global,L.events.messege,"No data source provided")}};this.iframeLoaded=function(){trace("iframeLoaded")};this.reload=function(h){trace("Load new timeline data"+h);VMM.fireEvent(global,L.events.messege,L.language.messages.loading_timeline);W={};VMM.Timeline.DataObj.getData(h);L.current_slide=0;g.setSlide(0);C.setMarker(0,L.ease,L.duration)};function A(h){VMM.getJSON(h,function(w){W=VMM.Timeline.DataObj.getData(w);VMM.fireEvent(global,L.events.data_ready)})}function b(w,Y,h){trace("showMessege "+Y);if(h){VMM.attachElement(T,Y)}else{VMM.attachElement(T,VMM.MediaElement.loadingmessage(Y))}}function z(){VMM.Lib.animate(T,L.duration,L.ease*4,{opacity:0},q)}function q(){VMM.Lib.detach(T)}function N(){if(parseInt(L.start_at_slide)>0&&L.current_slide==0){L.current_slide=parseInt(L.start_at_slide)}if(L.start_at_end&&L.current_slide==0){L.current_slide=R.length-1}if(s){s=true;VMM.fireEvent(global,L.events.messege,"Internet Explorer "+VMM.Browser.version+" is not supported by TimelineJS. Please update your browser to version 8 or higher.")}else{q();n();VMM.bindEvent(p,H,"LOADED");VMM.bindEvent(a,u,"LOADED");VMM.bindEvent(p,K,"UPDATE");VMM.bindEvent(a,E,"UPDATE");g.init(R);C.init(R,W.era);VMM.bindEvent(global,n,L.events.resize)}}function v(){trace("IE7 or lower");for(var h=0;h<R.length;h++){trace(R[h])}}function t(){trace("UPDATE SIZE");L.width=VMM.Lib.width(G);L.height=VMM.Lib.height(G);L.nav.width=L.width;L.feature.width=L.width;L.feature.height=L.height-L.nav.height-3;if(VMM.Browser.device=="mobile"){}if(L.width<640){VMM.Lib.addClass(G,"vco-skinny")}else{VMM.Lib.removeClass(G,"vco-skinny")}}function S(){R=[];VMM.fireEvent(global,L.events.messege,"Building Dates");t();for(var w=0;w<W.date.length;w++){if(W.date[w].startDate!=null&&W.date[w].startDate!=""){var h={};if(W.date[w].type=="tweets"){h.startdate=VMM.ExternalAPI.twitter.parseTwitterDate(W.date[w].startDate)}else{h.startdate=VMM.Date.parse(W.date[w].startDate)}if(!isNaN(h.startdate)){if(W.date[w].endDate!=null&&W.date[w].endDate!=""){if(W.date[w].type=="tweets"){h.enddate=VMM.ExternalAPI.twitter.parseTwitterDate(W.date[w].endDate)}else{h.enddate=VMM.Date.parse(W.date[w].endDate)}}else{h.enddate=h.startdate}h.needs_slug=false;if(W.date[w].headline==""){if(W.date[w].slug!=null&&W.date[w].slug!=""){h.needs_slug=true}}h.title=W.date[w].headline;h.headline=W.date[w].headline;h.type=W.date[w].type;h.date=VMM.Date.prettyDate(h.startdate);h.asset=W.date[w].asset;h.fulldate=h.startdate.getTime();h.text=W.date[w].text;h.content="";h.tag=W.date[w].tag;h.slug=W.date[w].slug;h.uniqueid=VMM.Util.unique_ID(7);R.push(h)}}}if(W.type!="storify"){R.sort(function(ac,ab){return ac.fulldate-ab.fulldate})}if(W.headline!=null&&W.headline!=""&&W.text!=null&&W.text!=""){var Z,h={},Y=0,aa;if(typeof W.startDate!="undefined"){Z=VMM.Date.parse(W.startDate)}else{Z=false}trace("HAS STARTPAGE");trace(Z);if(Z&&Z<R[0].startdate){h.startdate=new Date(Z)}else{aa=R[0].startdate;h.startdate=new Date(R[0].startdate);if(aa.getMonth()===0&&aa.getDate()==1&&aa.getHours()===0&&aa.getMinutes()===0){h.startdate.setFullYear(aa.getFullYear()-1)}else{if(aa.getDate()<=1&&aa.getHours()===0&&aa.getMinutes()===0){h.startdate.setMonth(aa.getMonth()-1)}else{if(aa.getHours()===0&&aa.getMinutes()===0){h.startdate.setDate(aa.getDate()-1)}else{if(aa.getMinutes()===0){h.startdate.setHours(aa.getHours()-1)}else{h.startdate.setMinutes(aa.getMinutes()-1)}}}}}h.uniqueid=VMM.Util.unique_ID(7);h.enddate=h.startdate;h.title=W.headline;h.headline=W.headline;h.text=W.text;h.type="start";h.date=VMM.Date.prettyDate(W.startDate);h.asset=W.asset;h.slug=false;h.needs_slug=false;h.fulldate=h.startdate.getTime();if(L.embed){VMM.fireEvent(global,L.events.headline,h.headline)}R.unshift(h)}if(W.type!="storify"){R.sort(function(ac,ab){return ac.fulldate-ab.fulldate})}I()}};VMM.Timeline.Config={}}if(typeof VMM.Timeline!="undefined"&&typeof VMM.Timeline.TimeNav=="undefined"){VMM.Timeline.TimeNav=function(t,B,k){trace("VMM.Timeline.TimeNav");var A,c,ap,ag,C,a,ad,W,M,j,ab,h,m,Q,J,X=VMM.Timeline.Config,S,P={},H={},V=t,am=[],N=[],an=[],u=[],U=[],T=[],R=0,e=false,G,s,ak={interval_position:""},L={left:"",visible:{left:"",right:""}},aa={day:24,month:12,year:10,hour:60,minute:60,second:1000,decade:10,century:100,millenium:1000,age:1000000,epoch:10000000,era:100000000,eon:500000000,week:4.34812141,days_in_month:30.4368499,days_in_week:7,weeks_in_month:4.34812141,weeks_in_year:52.177457,days_in_year:365.242199,hours_in_day:24},D={day:86400000,week:7,month:30.4166666667,year:12,hour:24,minute:1440,second:86400,decade:10,century:100,millenium:1000,age:1000000,epoch:10000000,era:100000000,eon:500000000},d={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"_idd",interval_type:"interval"},K={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"major",interval_type:"interval major"},z={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"_dd_minor",interval_type:"interval minor"},I={day:{},month:{},year:{},hour:{},minute:{},second:{},decade:{},century:{},millenium:{},week:{},age:{},epoch:{},era:{},eon:{}};S=X.nav.marker.height/2;X.nav.rows={full:[1,S*2,S*4],half:[1,S,S*2,S*3,S*4,S*5],current:[]};if(B!=null&&B!=""){X.nav.width=B}if(k!=null&&k!=""){X.nav.height=k}this.init=function(au,at){trace("VMM.Timeline.TimeNav init");if(typeof au!="undefined"){this.setData(au,at)}else{trace("WAITING ON DATA")}};this.setData=function(au,at){if(typeof au!="undefined"){am={};am=au;G=at;Z()}else{trace("NO DATA")}};this.setSize=function(at,au){if(at!=null){X.width=at}if(au!=null){X.height=au}if(e){r()}};this.setMarker=function(aw,av,au,at){ao(aw,av,au)};this.getCurrentNumber=function(){return R};function o(){trace("onConfigSet")}function r(at){X.nav.constraint.left=(X.width/2);X.nav.constraint.right=X.nav.constraint.right_min-(X.width/2);J.updateConstraint(X.nav.constraint);VMM.Lib.css(M,"left",Math.round(X.width/2)+2);VMM.Lib.css(j,"left",Math.round(X.width/2)-8);ao(X.current_slide,X.ease,X.duration,true,at)}function O(){VMM.fireEvent(V,"UPDATE")}function ar(){J.cancelSlide();if(X.nav.multiplier.current>X.nav.multiplier.min){if(X.nav.multiplier.current<=1){X.nav.multiplier.current=X.nav.multiplier.current-0.25}else{if(X.nav.multiplier.current>5){if(X.nav.multiplier.current>16){X.nav.multiplier.current=Math.round(X.nav.multiplier.current-10)}else{X.nav.multiplier.current=Math.round(X.nav.multiplier.current-4)}}else{X.nav.multiplier.current=Math.round(X.nav.multiplier.current-1)}}if(X.nav.multiplier.current<=0){X.nav.multiplier.current=X.nav.multiplier.min}w()}}function q(){J.cancelSlide();if(X.nav.multiplier.current<X.nav.multiplier.max){if(X.nav.multiplier.current>4){if(X.nav.multiplier.current>16){X.nav.multiplier.current=Math.round(X.nav.multiplier.current+10)}else{X.nav.multiplier.current=Math.round(X.nav.multiplier.current+4)}}else{X.nav.multiplier.current=Math.round(X.nav.multiplier.current+1)}if(X.nav.multiplier.current>=X.nav.multiplier.max){X.nav.multiplier.current=X.nav.multiplier.max}w()}}function n(at){J.cancelSlide();ao(0);O()}function g(au){var av=0,at=0;if(!au){au=window.event}if(au.originalEvent){au=au.originalEvent}if(au.wheelDelta){av=au.wheelDelta/6}else{if(au.detail){av=-au.detail*12}}if(av){if(au.preventDefault){au.preventDefault()}au.returnValue=false}if(typeof au.wheelDeltaX!="undefined"){av=au.wheelDeltaY/6;if(Math.abs(au.wheelDeltaX)>Math.abs(au.wheelDeltaY)){av=au.wheelDeltaX/6}else{av=au.wheelDeltaY/6}}at=VMM.Lib.position(A).left+av;if(at>X.nav.constraint.left){at=X.width/2}else{if(at<X.nav.constraint.right){at=X.nav.constraint.right}}VMM.Lib.css(A,"left",at)}var w=function(){trace("config.nav.multiplier "+X.nav.multiplier.current);ai(true);p(true);af(C,u,true,true);af(a,U,true);X.nav.constraint.left=(X.width/2);X.nav.constraint.right=X.nav.constraint.right_min-(X.width/2);J.updateConstraint(X.nav.constraint)};function y(at){J.cancelSlide();ao(at.data.number);O()}function aj(at){VMM.Lib.toggleClass(at.data.elem,"zFront")}var ao=function(au,aw,ax,aA,aB){trace("GO TO MARKER");var at=X.ease,az=X.duration,aC=false,av=false;R=au;L.left=(X.width/2)-an[R].pos_left;L.visible.left=Math.abs(L.left)-100;L.visible.right=Math.abs(L.left)+X.width+100;if(R==0){av=true}if(R+1==an.length){aC=true}if(aw!=null&&aw!=""){at=aw}if(ax!=null&&ax!=""){az=ax}for(var ay=0;ay<an.length;ay++){VMM.Lib.removeClass(an[ay].marker,"active")}if(X.start_page&&an[0].type=="start"){VMM.Lib.visible(an[0].marker,false);VMM.Lib.addClass(an[0].marker,"start")}VMM.Lib.addClass(an[R].marker,"active");VMM.Lib.stop(A);VMM.Lib.animate(A,az,at,{left:L.left})};function ac(au,at){VMM.Lib.animate(A,at.time/2,X.ease,{left:at.left})}var aq=function(){var av=0,ay=0,au=0,ax=[],aw=0;for(aw=0;aw<an.length;aw++){if(am[aw].type=="start"){}else{var at=v(d,an[aw].relative_pos),av=ay;ay=at.begin;au=ay-av;ax.push(au)}}return VMM.Util.average(ax).mean};var f=function(){var ax=0,at=0,aw="",ay=0,az=[],av=true,au=0;for(au=0;au<am.length;au++){if(am[au].type=="start"){trace("DATA DATE IS START")}else{aw=am[au].startdate;ax=at;at=aw;ay=at-ax;az.push(ay)}}return VMM.Util.average(az)};var al=function(){var at=X.nav.multiplier.current,au=0;for(au=0;au<at;au++){if(aq()<75){if(X.nav.multiplier.current>1){X.nav.multiplier.current=(X.nav.multiplier.current-1)}}}};var Y=function(){var au=F(am[0].startdate),at=F(am[am.length-1].enddate);I.eon.type="eon";I.eon.first=au.eons;I.eon.base=Math.floor(au.eons);I.eon.last=at.eons;I.eon.number=H.eons;I.eon.multiplier=aa.eons;I.eon.minor=aa.eons;I.era.type="era";I.era.first=au.eras;I.era.base=Math.floor(au.eras);I.era.last=at.eras;I.era.number=H.eras;I.era.multiplier=aa.eras;I.era.minor=aa.eras;I.epoch.type="epoch";I.epoch.first=au.epochs;I.epoch.base=Math.floor(au.epochs);I.epoch.last=at.epochs;I.epoch.number=H.epochs;I.epoch.multiplier=aa.epochs;I.epoch.minor=aa.epochs;I.age.type="age";I.age.first=au.ages;I.age.base=Math.floor(au.ages);I.age.last=at.ages;I.age.number=H.ages;I.age.multiplier=aa.ages;I.age.minor=aa.ages;I.millenium.type="millenium";I.millenium.first=au.milleniums;I.millenium.base=Math.floor(au.milleniums);I.millenium.last=at.milleniums;I.millenium.number=H.milleniums;I.millenium.multiplier=aa.millenium;I.millenium.minor=aa.millenium;I.century.type="century";I.century.first=au.centuries;I.century.base=Math.floor(au.centuries);I.century.last=at.centuries;I.century.number=H.centuries;I.century.multiplier=aa.century;I.century.minor=aa.century;I.decade.type="decade";I.decade.first=au.decades;I.decade.base=Math.floor(au.decades);I.decade.last=at.decades;I.decade.number=H.decades;I.decade.multiplier=aa.decade;I.decade.minor=aa.decade;I.year.type="year";I.year.first=au.years;I.year.base=Math.floor(au.years);I.year.last=at.years;I.year.number=H.years;I.year.multiplier=1;I.year.minor=aa.month;I.month.type="month";I.month.first=au.months;I.month.base=Math.floor(au.months);I.month.last=at.months;I.month.number=H.months;I.month.multiplier=1;I.month.minor=Math.round(aa.week);I.week.type="week";I.week.first=au.weeks;I.week.base=Math.floor(au.weeks);I.week.last=at.weeks;I.week.number=H.weeks;I.week.multiplier=1;I.week.minor=7;I.day.type="day";I.day.first=au.days;I.day.base=Math.floor(au.days);I.day.last=at.days;I.day.number=H.days;I.day.multiplier=1;I.day.minor=24;I.hour.type="hour";I.hour.first=au.hours;I.hour.base=Math.floor(au.hours);I.hour.last=at.hours;I.hour.number=H.hours;I.hour.multiplier=1;I.hour.minor=60;I.minute.type="minute";I.minute.first=au.minutes;I.minute.base=Math.floor(au.minutes);I.minute.last=at.minutes;I.minute.number=H.minutes;I.minute.multiplier=1;I.minute.minor=60;I.second.type="decade";I.second.first=au.seconds;I.second.base=Math.floor(au.seconds);I.second.last=at.seconds;I.second.number=H.seconds;I.second.multiplier=1;I.second.minor=10};var F=function(au,av){var at={};at.days=au/D.day;at.weeks=at.days/D.week;at.months=at.days/D.month;at.years=at.months/D.year;at.hours=at.days*D.hour;at.minutes=at.days*D.minute;at.seconds=at.days*D.second;at.decades=at.years/D.decade;at.centuries=at.years/D.century;at.milleniums=at.years/D.millenium;at.ages=at.years/D.age;at.epochs=at.years/D.epoch;at.eras=at.years/D.era;at.eons=at.years/D.eon;return at};var b=function(au,az,ax){var aw,av,at=au.type,ay={start:"",end:"",type:at};aw=F(az);ay.start=az.months;if(at=="eon"){ay.start=aw.eons}else{if(at=="era"){ay.start=aw.eras}else{if(at=="epoch"){ay.start=aw.epochs}else{if(at=="age"){ay.start=aw.ages}else{if(at=="millenium"){ay.start=az.milleniums}else{if(at=="century"){ay.start=aw.centuries}else{if(at=="decade"){ay.start=aw.decades}else{if(at=="year"){ay.start=aw.years}else{if(at=="month"){ay.start=aw.months}else{if(at=="week"){ay.start=aw.weeks}else{if(at=="day"){ay.start=aw.days}else{if(at=="hour"){ay.start=aw.hours}else{if(at=="minute"){ay.start=aw.minutes}}}}}}}}}}}}}if(type.of(ax)=="date"){av=F(ax);ay.end=ax.months;if(at=="eon"){ay.end=av.eons}else{if(at=="era"){ay.end=av.eras}else{if(at=="epoch"){ay.end=av.epochs}else{if(at=="age"){ay.end=av.ages}else{if(at=="millenium"){ay.end=ax.milleniums}else{if(at=="century"){ay.end=av.centuries}else{if(at=="decade"){ay.end=av.decades}else{if(at=="year"){ay.end=av.years}else{if(at=="month"){ay.end=av.months}else{if(at=="week"){ay.end=av.weeks}else{if(at=="day"){ay.end=av.days}else{if(at=="hour"){ay.end=av.hours}else{if(at=="minute"){ay.end=av.minutes}}}}}}}}}}}}}}else{ay.end=ay.start}return ay};var v=function(au,at){return{begin:(at.start-d.base)*(X.nav.interval_width/X.nav.multiplier.current),end:(at.end-d.base)*(X.nav.interval_width/X.nav.multiplier.current)}};var ai=function(aK){var aA=2,ax=0,ay=-2,aw=0,av=0,aI=150,aE=6,aN=0,au=X.width,aM=[],aO=6,aC={left:L.visible.left-au,right:L.visible.right+au},aL=0,aJ=0;X.nav.minor_width=X.width;VMM.Lib.removeClass(".flag","row1");VMM.Lib.removeClass(".flag","row2");VMM.Lib.removeClass(".flag","row3");for(aL=0;aL<an.length;aL++){var aD,aB=an[aL],az=v(d,an[aL].relative_pos),aG=0,aF=false,aH={id:aL,pos:0,row:0},at=0;az.begin=Math.round(az.begin+ay);az.end=Math.round(az.end+ay);aD=Math.round(az.end-az.begin);aB.pos_left=az.begin;if(R==aL){L.left=(X.width/2)-az;L.visible.left=Math.abs(L.left);L.visible.right=Math.abs(L.left)+X.width;aC.left=L.visible.left-au;aC.right=L.visible.right+au}if(Math.abs(az.begin)>=aC.left&&Math.abs(az.begin)<=aC.right){aF=true}if(aK){VMM.Lib.stop(aB.marker);VMM.Lib.animate(aB.marker,X.duration/2,X.ease,{left:az.begin})}else{VMM.Lib.stop(aB.marker);VMM.Lib.css(aB.marker,"left",az.begin)}if(aL==R){aN=az.begin}if(aD>5){VMM.Lib.css(aB.lineevent,"height",aE);VMM.Lib.css(aB.lineevent,"top",aI);if(aK){VMM.Lib.animate(aB.lineevent,X.duration/2,X.ease,{width:aD})}else{VMM.Lib.css(aB.lineevent,"width",aD)}}if(T.length>0){for(aJ=0;aJ<T.length;aJ++){if(aJ<X.nav.rows.current.length){if(aB.tag==T[aJ]){aA=aJ;if(aJ==X.nav.rows.current.length-1){trace("ON LAST ROW");VMM.Lib.addClass(aB.flag,"flag-small-last")}}}}aG=X.nav.rows.current[aA]}else{if(az.begin-ax.begin<(X.nav.marker.width+X.spacing)){if(aA<X.nav.rows.current.length-1){aA++}else{aA=0;aw++}}else{aw=1;aA=1}aG=X.nav.rows.current[aA]}ax=az;aH.pos=az;aH.row=aA;aM.push(aH);if(aM.length>aO){aM.remove(0)}if(aK){VMM.Lib.stop(aB.flag);VMM.Lib.animate(aB.flag,X.duration,X.ease,{top:aG})}else{VMM.Lib.stop(aB.flag);VMM.Lib.css(aB.flag,"top",aG)}if(X.start_page&&an[aL].type=="start"){VMM.Lib.visible(aB.marker,false)}if(az>X.nav.minor_width){X.nav.minor_width=az}if(az<X.nav.minor_left){X.nav.minor_left=az}}if(aK){VMM.Lib.stop(A);VMM.Lib.animate(A,X.duration/2,X.ease,{left:(X.width/2)-(aN)})}else{}};var p=function(at){var ax=0,az=0;for(ax=0;ax<N.length;ax++){var av=N[ax],aA=v(d,av.relative_pos),aw=0,ay=X.nav.marker.height*X.nav.rows.full.length,au=aA.end-aA.begin;if(av.tag!=""){ay=(X.nav.marker.height*X.nav.rows.full.length)/X.nav.rows.current.length;for(az=0;az<T.length;az++){if(az<X.nav.rows.current.length){if(av.tag==T[az]){row=az}}}aw=X.nav.rows.current[row]}else{aw=-1}if(at){VMM.Lib.stop(av.content);VMM.Lib.stop(av.text_content);VMM.Lib.animate(av.content,X.duration/2,X.ease,{top:aw,left:aA.begin,width:au,height:ay});VMM.Lib.animate(av.text_content,X.duration/2,X.ease,{left:aA.begin})}else{VMM.Lib.stop(av.content);VMM.Lib.stop(av.text_content);VMM.Lib.css(av.content,"left",aA.begin);VMM.Lib.css(av.content,"width",au);VMM.Lib.css(av.content,"height",ay);VMM.Lib.css(av.content,"top",aw);VMM.Lib.css(av.text_content,"left",aA.begin)}}};var af=function(av,aC,aB,ay){var aE=0,at=0,aF=X.width,au={left:L.visible.left-aF,right:L.visible.right+aF};not_too_many=true,i=0;X.nav.minor_left=0;if(aC.length>100){not_too_many=false;trace("TOO MANY "+aC.length)}for(i=0;i<aC.length;i++){var ax=aC[i].element,aw=aC[i].date,aJ=aC[i].visible,aH=v(d,aC[i].relative_pos),aD=aH.begin,az=aC[i].animation,aG=true,aI=false,aA=50;az.pos=aD;az.animate=false;if(Math.abs(aD)>=au.left&&Math.abs(aD)<=au.right){aI=true}if(true){if(X.nav.multiplier.current>16&&ay){aG=false}else{if((aD-aE)<65){if((aD-aE)<35){if(i%4==0){if(aD==0){aG=false}}else{aG=false}}else{if(!VMM.Util.isEven(i)){aG=false}}}}if(aG){if(aC[i].is_detached){VMM.Lib.append(av,ax);aC[i].is_detached=false}}else{aC[i].is_detached=true;VMM.Lib.detach(ax)}if(aJ){if(!aG){az.opacity="0";if(aB&&not_too_many){az.animate=true}aC[i].interval_visible=false}else{az.opacity="100";if(aB&&aI){az.animate=true}}}else{az.opacity="100";if(aG){if(aB&&not_too_many){az.animate=true}else{if(aB&&aI){az.animate=true}}aC[i].interval_visible=true}else{if(aB&&not_too_many){az.animate=true}}}aE=aD;if(aD>X.nav.minor_width){X.nav.minor_width=aD}if(aD<X.nav.minor_left){X.nav.minor_left=aD}}if(az.animate){VMM.Lib.animate(ax,X.duration/2,X.ease,{opacity:az.opacity,left:az.pos})}else{VMM.Lib.css(ax,"opacity",az.opacity);VMM.Lib.css(ax,"left",aD)}}X.nav.constraint.right_min=-(X.nav.minor_width)+(X.width);X.nav.constraint.right=X.nav.constraint.right_min+(X.width/2);VMM.Lib.css(ab,"left",X.nav.minor_left-(X.width)/2);VMM.Lib.width(ab,(X.nav.minor_width)+(X.width)+Math.abs(X.nav.minor_left))};var ah=function(av,aF,au){var aw=0,aG=true,aB=0,aA=0,az,aH,ax,aE=Math.ceil(av.number)+2,aC={flag:false,offset:0},ay=0;VMM.attachElement(au,"");av.date=new Date(am[0].startdate.getFullYear(),0,1,0,0,0);az=av.date.getTimezoneOffset();for(ay=0;ay<aE;ay++){trace(av.type);var aD=false,at={element:VMM.appendAndGetElement(au,"<div>",av.classname),date:new Date(am[0].startdate.getFullYear(),0,1,0,0,0),visible:false,date_string:"",type:av.interval_type,relative_pos:0,is_detached:false,animation:{animate:false,pos:"",opacity:"100"}};if(av.type=="eon"){if(aG){aH=Math.floor(am[0].startdate.getFullYear()/500000000)*500000000}at.date.setFullYear(aH+(aw*500000000));aD=true}else{if(av.type=="era"){if(aG){aH=Math.floor(am[0].startdate.getFullYear()/100000000)*100000000}at.date.setFullYear(aH+(aw*100000000));aD=true}else{if(av.type=="epoch"){if(aG){aH=Math.floor(am[0].startdate.getFullYear()/10000000)*10000000}at.date.setFullYear(aH+(aw*10000000));aD=true}else{if(av.type=="age"){if(aG){aH=Math.floor(am[0].startdate.getFullYear()/1000000)*1000000}at.date.setFullYear(aH+(aw*1000000));aD=true}else{if(av.type=="millenium"){if(aG){aH=Math.floor(am[0].startdate.getFullYear()/1000)*1000}at.date.setFullYear(aH+(aw*1000));aD=true}else{if(av.type=="century"){if(aG){aH=Math.floor(am[0].startdate.getFullYear()/100)*100}at.date.setFullYear(aH+(aw*100));aD=true}else{if(av.type=="decade"){if(aG){aH=Math.floor(am[0].startdate.getFullYear()/10)*10}at.date.setFullYear(aH+(aw*10));aD=true}else{if(av.type=="year"){if(aG){aH=am[0].startdate.getFullYear()}at.date.setFullYear(aH+aw);aD=true}else{if(av.type=="month"){if(aG){aH=am[0].startdate.getMonth()}at.date.setMonth(aH+aw)}else{if(av.type=="week"){if(aG){aH=am[0].startdate.getMonth()}at.date.setMonth(am[0].startdate.getMonth());at.date.setDate(aH+(aw*7))}else{if(av.type=="day"){if(aG){aH=am[0].startdate.getDate()}at.date.setMonth(am[0].startdate.getMonth());at.date.setDate(aH+aw)}else{if(av.type=="hour"){if(aG){aH=am[0].startdate.getHours()}at.date.setMonth(am[0].startdate.getMonth());at.date.setDate(am[0].startdate.getDate());at.date.setHours(aH+aw)}else{if(av.type=="minute"){if(aG){aH=am[0].startdate.getMinutes()}at.date.setMonth(am[0].startdate.getMonth());at.date.setDate(am[0].startdate.getDate());at.date.setHours(am[0].startdate.getHours());at.date.setMinutes(aH+aw)}else{if(av.type=="second"){if(aG){aH=am[0].startdate.getSeconds()}at.date.setMonth(am[0].startdate.getMonth());at.date.setDate(am[0].startdate.getDate());at.date.setHours(am[0].startdate.getHours());at.date.setMinutes(am[0].startdate.getMinutes());at.date.setSeconds(aH+aw)}else{if(av.type=="millisecond"){if(aG){aH=am[0].startdate.getMilliseconds()}at.date.setMonth(am[0].startdate.getMonth());at.date.setDate(am[0].startdate.getDate());at.date.setHours(am[0].startdate.getHours());at.date.setMinutes(am[0].startdate.getMinutes());at.date.setSeconds(am[0].startdate.getSeconds());at.date.setMilliseconds(aH+aw)}}}}}}}}}}}}}}}if(VMM.Browser.browser=="Firefox"){if(at.date.getFullYear()=="1970"&&at.date.getTimezoneOffset()!=az){trace("FIREFOX 1970 TIMEZONE OFFSET "+at.date.getTimezoneOffset()+" SHOULD BE "+az);trace(av.type+" "+av.date);aC.offset=(at.date.getTimezoneOffset()/60);aC.flag=true;at.date.setHours(at.date.getHours()+aC.offset)}else{if(aC.flag){aC.flag=false;at.date.setHours(at.date.getHours()+aC.offset);if(aD){aC.flag=true}}}}if(aD){if(at.date.getFullYear()<0){at.date_string=Math.abs(at.date.getFullYear()).toString()+" B.C."}else{at.date_string=at.date.getFullYear()}}else{at.date_string=VMM.Date.prettyDate(at.date,true)}aw=aw+1;aG=false;at.relative_pos=b(d,at.date);aB=at.relative_pos.begin;if(at.relative_pos.begin>aA){aA=at.relative_pos.begin}VMM.appendElement(at.element,at.date_string);VMM.Lib.css(at.element,"text-indent",-(VMM.Lib.width(at.element)/2));VMM.Lib.css(at.element,"opacity","0");aF.push(at)}VMM.Lib.width(ab,aA);af(au,aF)};var Z=function(){var au=0,at=0;VMM.attachElement(V,"");A=VMM.appendAndGetElement(V,"<div>","timenav");c=VMM.appendAndGetElement(A,"<div>","content");ap=VMM.appendAndGetElement(A,"<div>","time");ag=VMM.appendAndGetElement(ap,"<div>","time-interval-minor");ab=VMM.appendAndGetElement(ag,"<div>","minor");a=VMM.appendAndGetElement(ap,"<div>","time-interval-major");C=VMM.appendAndGetElement(ap,"<div>","time-interval");ad=VMM.appendAndGetElement(V,"<div>","timenav-background");M=VMM.appendAndGetElement(ad,"<div>","timenav-line");j=VMM.appendAndGetElement(ad,"<div>","timenav-indicator");W=VMM.appendAndGetElement(ad,"<div>","timenav-interval-background","<div class='top-highlight'></div>");h=VMM.appendAndGetElement(V,"<div>","vco-toolbar");l();E();ae();al();ai(false);p();af(C,u,false,true);af(a,U);if(X.start_page){$backhome=VMM.appendAndGetElement(h,"<div>","back-home","<div class='icon'></div>");VMM.bindEvent(".back-home",n,"click");VMM.Lib.attribute($backhome,"title",VMM.master_config.language.messages.return_to_title);VMM.Lib.attribute($backhome,"rel","tooltip")}J=new VMM.DragSlider;J.createPanel(V,A,X.nav.constraint,X.touch);if(X.touch&&X.start_page){VMM.Lib.addClass(h,"touch");VMM.Lib.css(h,"top",55);VMM.Lib.css(h,"left",10)}else{if(X.start_page){VMM.Lib.css(h,"top",27)}m=VMM.appendAndGetElement(h,"<div>","zoom-in","<div class='icon'></div>");Q=VMM.appendAndGetElement(h,"<div>","zoom-out","<div class='icon'></div>");VMM.bindEvent(m,ar,"click");VMM.bindEvent(Q,q,"click");VMM.Lib.attribute(m,"title",VMM.master_config.language.messages.expand_timeline);VMM.Lib.attribute(m,"rel","tooltip");VMM.Lib.attribute(Q,"title",VMM.master_config.language.messages.contract_timeline);VMM.Lib.attribute(Q,"rel","tooltip");h.tooltip({selector:"div[rel=tooltip]",placement:"right"});VMM.bindEvent(V,g,"DOMMouseScroll");VMM.bindEvent(V,g,"mousewheel")}if(X.nav.zoom.adjust!=0){if(X.nav.zoom.adjust<0){for(au=0;au<Math.abs(X.nav.zoom.adjust);au++){q()}}else{for(at=0;at<X.nav.zoom.adjust;at++){ar()}}}e=true;r(true);VMM.fireEvent(V,"LOADED")};var l=function(){var au=0,at=0;H=F((am[am.length-1].enddate)-(am[0].startdate),true);trace(H);Y();if(H.centuries>am.length/X.nav.density){d=I.century;K=I.millenium;z=I.decade}else{if(H.decades>am.length/X.nav.density){d=I.decade;K=I.century;z=I.year}else{if(H.years>am.length/X.nav.density){d=I.year;K=I.decade;z=I.month}else{if(H.months>am.length/X.nav.density){d=I.month;K=I.year;z=I.day}else{if(H.days>am.length/X.nav.density){d=I.day;K=I.month;z=I.hour}else{if(H.hours>am.length/X.nav.density){d=I.hour;K=I.day;z=I.minute}else{if(H.minutes>am.length/X.nav.density){d=I.minute;K=I.hour;z=I.second}else{if(H.seconds>am.length/X.nav.density){d=I.second;K=I.minute;z=I.second}else{trace("NO IDEA WHAT THE TYPE SHOULD BE");d=I.day;K=I.month;z=I.hour}}}}}}}}trace("INTERVAL TYPE: "+d.type);trace("INTERVAL MAJOR TYPE: "+K.type);ah(d,u,C);ah(K,U,a);for(au=0;au<u.length;au++){for(at=0;at<U.length;at++){if(u[au].date_string==U[at].date_string){VMM.attachElement(u[au].element,"")}}}};var E=function(){var aJ=2,aB=0,aA=0,ay=0,ax=0,aw=0;an=[];N=[];for(ay=0;ay<am.length;ay++){var aE,aC,aD,aH,aG,az,av,aF="",aI=false;aE=VMM.appendAndGetElement(c,"<div>","marker");aC=VMM.appendAndGetElement(aE,"<div>","flag");aD=VMM.appendAndGetElement(aC,"<div>","flag-content");aH=VMM.appendAndGetElement(aE,"<div>","dot");aG=VMM.appendAndGetElement(aE,"<div>","line");az=VMM.appendAndGetElement(aG,"<div>","event-line");_marker_relative_pos=b(d,am[ay].startdate,am[ay].enddate);_marker_thumb="";if(am[ay].asset!=null&&am[ay].asset!=""){VMM.appendElement(aD,VMM.MediaElement.thumbnail(am[ay].asset,24,24,am[ay].uniqueid))}else{VMM.appendElement(aD,"<div style='margin-right:7px;height:50px;width:2px;float:left;'></div>")}if(am[ay].title==""||am[ay].title==" "){trace("TITLE NOTHING");if(typeof am[ay].slug!="undefined"&&am[ay].slug!=""){trace("SLUG");aF=VMM.Util.untagify(am[ay].slug);aI=true}else{var at=VMM.MediaType(am[ay].asset.media);if(at.type=="quote"||at.type=="unknown"){aF=VMM.Util.untagify(at.id);aI=true}else{aI=false}}}else{if(am[ay].title!=""||am[ay].title!=" "){trace(am[ay].title);aF=VMM.Util.untagify(am[ay].title);aI=true}else{trace("TITLE SLUG NOT FOUND "+am[ay].slug)}}if(aI){VMM.appendElement(aD,"<h3>"+aF+"</h3>")}else{VMM.appendElement(aD,"<h3>"+aF+"</h3>");VMM.appendElement(aD,"<h3 id='marker_content_"+am[ay].uniqueid+"'>"+aF+"</h3>")}VMM.Lib.attr(aE,"id",("marker_"+am[ay].uniqueid).toString());VMM.bindEvent(aC,y,"",{number:ay});VMM.bindEvent(aC,aj,"mouseenter mouseleave",{number:ay,elem:aC});av={marker:aE,flag:aC,lineevent:az,type:"marker",full:true,relative_pos:_marker_relative_pos,tag:am[ay].tag,pos_left:0};if(am[ay].type=="start"){trace("BUILD MARKER HAS START PAGE");X.start_page=true;av.type="start"}if(am[ay].type=="storify"){av.type="storify"}if(am[ay].tag){T.push(am[ay].tag)}an.push(av)}T=VMM.Util.deDupeArray(T);if(T.length>3){X.nav.rows.current=X.nav.rows.half}else{X.nav.rows.current=X.nav.rows.full}for(ax=0;ax<T.length;ax++){if(ax<X.nav.rows.current.length){var au=VMM.appendAndGetElement(ad,"<div>","timenav-tag");VMM.Lib.addClass(au,"timenav-tag-row-"+(ax+1));if(T.length>3){VMM.Lib.addClass(au,"timenav-tag-size-half")}else{VMM.Lib.addClass(au,"timenav-tag-size-full")}VMM.appendElement(au,"<div><h3>"+T[ax]+"</h3></div>")}}if(T.length>3){for(aw=0;aw<an.length;aw++){VMM.Lib.addClass(an[aw].flag,"flag-small");an[aw].full=false}}};var ae=function(){var ax=6,az=0,aw=0;for(aw=0;aw<G.length;aw++){var at={content:VMM.appendAndGetElement(c,"<div>","era"),text_content:VMM.appendAndGetElement(C,"<div>","era"),startdate:VMM.Date.parse(G[aw].startDate),enddate:VMM.Date.parse(G[aw].endDate),title:G[aw].headline,uniqueid:VMM.Util.unique_ID(6),tag:"",relative_pos:""},av=VMM.Date.prettyDate(at.startdate),au=VMM.Date.prettyDate(at.enddate),ay="<div>&nbsp;</div>";if(typeof G[aw].tag!="undefined"){at.tag=G[aw].tag}at.relative_pos=b(d,at.startdate,at.enddate);VMM.Lib.attr(at.content,"id",at.uniqueid);VMM.Lib.attr(at.text_content,"id",at.uniqueid+"_text");VMM.Lib.addClass(at.content,"era"+(az+1));VMM.Lib.addClass(at.text_content,"era"+(az+1));if(az<ax){az++}else{az=0}VMM.appendElement(at.content,ay);VMM.appendElement(at.text_content,VMM.Util.unlinkify(at.title));N.push(at)}}}}if(typeof VMM.Timeline!=="undefined"&&typeof VMM.Timeline.DataObj=="undefined"){VMM.Timeline.DataObj={data_obj:{},model_array:[],getData:function(a){VMM.Timeline.DataObj.data_obj={};VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Timeline.Config.language.messages.loading_timeline);if(type.of(a)=="object"){trace("DATA SOURCE: JSON OBJECT");VMM.Timeline.DataObj.parseJSON(a)}else{if(type.of(a)=="string"){if(a.match("%23")){trace("DATA SOURCE: TWITTER SEARCH");VMM.Timeline.DataObj.model.tweets.getData("%23medill")}else{if(a.match("spreadsheet")){trace("DATA SOURCE: GOOGLE SPREADSHEET");VMM.Timeline.DataObj.model.googlespreadsheet.getData(a)}else{if(a.match("storify.com")){trace("DATA SOURCE: STORIFY");VMM.Timeline.DataObj.model.storify.getData(a)}else{if(a.match(".jsonp")){trace("DATA SOURCE: JSONP");LoadLib.js(a,VMM.Timeline.DataObj.onJSONPLoaded)}else{trace("DATA SOURCE: JSON");VMM.getJSON(a+"?callback=onJSONP_Data",VMM.Timeline.DataObj.parseJSON)}}}}}else{if(type.of(a)=="html"){trace("DATA SOURCE: HTML");VMM.Timeline.DataObj.parseHTML(a)}else{trace("DATA SOURCE: UNKNOWN")}}}},onJSONPLoaded:function(){trace("JSONP IS LOADED");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,storyjs_jsonp_data)},parseHTML:function(b){trace("parseHTML");trace("WARNING: THIS IS STILL ALPHA AND WILL NOT WORK WITH ID's other than #timeline");var c=VMM.Timeline.DataObj.data_template_obj;if(VMM.Lib.find("#timeline section","time")[0]){c.timeline.startDate=VMM.Lib.html(VMM.Lib.find("#timeline section","time")[0]);c.timeline.headline=VMM.Lib.html(VMM.Lib.find("#timeline section","h2"));c.timeline.text=VMM.Lib.html(VMM.Lib.find("#timeline section","article"));var a=false;if(VMM.Lib.find("#timeline section","figure img").length!=0){a=true;c.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure img"),"src")}else{if(VMM.Lib.find("#timeline section","figure a").length!=0){a=true;c.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure a"),"href")}else{}}if(a){if(VMM.Lib.find("#timeline section","cite").length!=0){c.timeline.asset.credit=VMM.Lib.html(VMM.Lib.find("#timeline section","cite"))}if(VMM.Lib.find(this,"figcaption").length!=0){c.timeline.asset.caption=VMM.Lib.html(VMM.Lib.find("#timeline section","figcaption"))}}}VMM.Lib.each("#timeline li",function(f,g){var e=false;var d={type:"default",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"};if(VMM.Lib.find(this,"time")!=0){e=true;d.startDate=VMM.Lib.html(VMM.Lib.find(this,"time")[0]);if(VMM.Lib.find(this,"time")[1]){d.endDate=VMM.Lib.html(VMM.Lib.find(this,"time")[1])}d.headline=VMM.Lib.html(VMM.Lib.find(this,"h3"));d.text=VMM.Lib.html(VMM.Lib.find(this,"article"));var h=false;if(VMM.Lib.find(this,"figure img").length!=0){h=true;d.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure img"),"src")}else{if(VMM.Lib.find(this,"figure a").length!=0){h=true;d.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure a"),"href")}else{}}if(h){if(VMM.Lib.find(this,"cite").length!=0){d.asset.credit=VMM.Lib.html(VMM.Lib.find(this,"cite"))}if(VMM.Lib.find(this,"figcaption").length!=0){d.asset.caption=VMM.Lib.html(VMM.Lib.find(this,"figcaption"))}}trace(d);c.timeline.date.push(d)}});VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,c)},parseJSON:function(a){trace("parseJSON");if(a.timeline.type=="default"){trace("DATA SOURCE: JSON STANDARD TIMELINE");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,a)}else{if(a.timeline.type=="twitter"){trace("DATA SOURCE: JSON TWEETS");VMM.Timeline.DataObj.model_Tweets.buildData(a)}else{trace("DATA SOURCE: UNKNOWN JSON");trace(type.of(a.timeline))}}},model:{googlespreadsheet:{getData:function(c){var a,d,b,e,g=0;d=VMM.Util.getUrlVars(c)["key"];if(d){b="https://spreadsheets.google.com/feeds/list/"+d+"/od6/public/values?alt=json"}else{b=c}e=setTimeout(function(){trace("Google Docs timeout "+b);trace(b);if(g<3){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+g);g++;a.abort();f()}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")}},16000);function f(){a=VMM.getJSON(b,function(h){clearTimeout(e);VMM.Timeline.DataObj.model.googlespreadsheet.buildData(h)}).error(function(h,k,j){trace("Google Docs ERROR");trace("Google Docs ERROR: "+k+" "+h.responseText)}).success(function(h){clearTimeout(e)})}f()},buildData:function(h){var f=VMM.Timeline.DataObj.data_template_obj,j=false;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Google Doc Data");function b(d){if(typeof d!="undefined"){return d.$t}else{return""}}if(typeof h.feed.entry!="undefined"){j=true;for(var g=0;g<h.feed.entry.length;g++){var k=h.feed.entry[g],e="";if(typeof k.gsx$type!="undefined"){e=k.gsx$type.$t}else{if(typeof k.gsx$titleslide!="undefined"){e=k.gsx$titleslide.$t}}if(e.match("start")||e.match("title")){f.timeline.startDate=b(k.gsx$startdate);f.timeline.headline=b(k.gsx$headline);f.timeline.asset.media=b(k.gsx$media);f.timeline.asset.caption=b(k.gsx$mediacaption);f.timeline.asset.credit=b(k.gsx$mediacredit);f.timeline.text=b(k.gsx$text);f.timeline.type="google spreadsheet"}else{if(e.match("era")){var a={startDate:b(k.gsx$startdate),endDate:b(k.gsx$enddate),headline:b(k.gsx$headline),text:b(k.gsx$text),tag:b(k.gsx$tag)};f.timeline.era.push(a)}else{var c={type:"google spreadsheet",startDate:b(k.gsx$startdate),endDate:b(k.gsx$enddate),headline:b(k.gsx$headline),text:b(k.gsx$text),tag:b(k.gsx$tag),asset:{media:b(k.gsx$media),credit:b(k.gsx$mediacredit),caption:b(k.gsx$mediacaption),thumbnail:b(k.gsx$mediathumbnail)}};f.timeline.date.push(c)}}}}else{}if(j){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,f)}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading+" Google Doc Data (cells)");trace("There may be too many entries. Still trying to load data. Now trying to load cells to avoid Googles limitation on cells");VMM.Timeline.DataObj.model.googlespreadsheet.getDataCells(h.feed.link[0].href)}},getDataCells:function(c){var a,d,b,e,g=0;d=VMM.Util.getUrlVars(c)["key"];b="https://spreadsheets.google.com/feeds/cells/"+d+"/od6/public/values?alt=json";e=setTimeout(function(){trace("Google Docs timeout "+b);trace(b);if(g<3){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+g);g++;a.abort();f()}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")}},16000);function f(){a=VMM.getJSON(b,function(h){clearTimeout(e);VMM.Timeline.DataObj.model.googlespreadsheet.buildDataCells(h)}).error(function(h,k,j){trace("Google Docs ERROR");trace("Google Docs ERROR: "+k+" "+h.responseText)}).success(function(h){clearTimeout(e)})}f()},buildDataCells:function(n){var j=VMM.Timeline.DataObj.data_template_obj,p=false,a=["timeline"],m=[],o=0,l=0,h=0;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading_timeline+" Parsing Google Doc Data (cells)");function e(d){if(typeof d!="undefined"){return d.$t}else{return""}}if(typeof n.feed.entry!="undefined"){p=true;for(l=0;l<n.feed.entry.length;l++){var r=n.feed.entry[l];if(parseInt(r.gs$cell.row)>o){o=parseInt(r.gs$cell.row)}}for(var l=0;l<o+1;l++){var f={type:"",startDate:"",endDate:"",headline:"",text:"",tag:"",asset:{media:"",credit:"",caption:"",thumbnail:""}};m.push(f)}for(l=0;l<n.feed.entry.length;l++){var r=n.feed.entry[l],g="",c="",q={content:e(r.gs$cell),col:r.gs$cell.col,row:r.gs$cell.row,name:""};if(q.row==1){if(q.content=="Start Date"){c="startDate"}else{if(q.content=="End Date"){c="endDate"}else{if(q.content=="Headline"){c="headline"}else{if(q.content=="Text"){c="text"}else{if(q.content=="Media"){c="media"}else{if(q.content=="Media Credit"){c="credit"}else{if(q.content=="Media Caption"){c="caption"}else{if(q.content=="Media Thumbnail"){c="thumbnail"}else{if(q.content=="Type"){c="type"}else{if(q.content=="Tag"){c="tag"}}}}}}}}}}a.push(c)}else{q.name=a[q.col];m[q.row][q.name]=q.content}}for(l=0;l<m.length;l++){var f=m[l];if(f.type.match("start")||f.type.match("title")){j.timeline.startDate=f.startDate;j.timeline.headline=f.headline;j.timeline.asset.media=f.media;j.timeline.asset.caption=f.caption;j.timeline.asset.credit=f.credit;j.timeline.text=f.text;j.timeline.type="google spreadsheet"}else{if(f.type.match("era")){var b={startDate:f.startDate,endDate:f.endDate,headline:f.headline,text:f.text,tag:f.tag};j.timeline.era.push(b)}else{var f={type:"google spreadsheet",startDate:f.startDate,endDate:f.endDate,headline:f.headline,text:f.text,tag:f.tag,asset:{media:f.media,credit:f.credit,caption:f.caption,thumbnail:f.thumbnail}};j.timeline.date.push(f)}}}}if(p){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data");VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,j)}else{VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Unable to load Google Doc data source")}}},storify:{getData:function(c){var d,b,a;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Loading Storify...");d=c.split("storify.com/")[1];b="http://api.storify.com/v1/stories/"+d+"?per_page=300&callback=?";a=setTimeout(function(){trace("STORIFY timeout");VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Storify is not responding")},6000);VMM.getJSON(b,VMM.Timeline.DataObj.model.storify.buildData).error(function(e,g,f){trace("STORIFY error");trace("STORIFY ERROR: "+g+" "+e.responseText)}).success(function(e){clearTimeout(a)})},buildData:function(j){VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Data");var f=VMM.Timeline.DataObj.data_template_obj;f.timeline.startDate=new Date(j.content.date.created);f.timeline.headline=j.content.title;trace(j);var h="";var b=j.content.author.username;var a="";if(typeof j.content.author.name!="undefined"){b=j.content.author.name;a=j.content.author.username+"&nbsp;"}if(typeof j.content.description!="undefined"&&j.content.description!=null){h+=j.content.description}h+="<div class='storify'>";h+="<div class='vcard author'><a class='screen-name url' href='"+j.content.author.permalink+"' target='_blank'>";h+="<span class='avatar'><img src='"+j.content.author.avatar+"' style='max-width: 32px; max-height: 32px;'></span>";h+="<span class='fn'>"+b+"</span>";h+="<span class='nickname'>"+a+"<span class='thumbnail-inline'></span></span>";h+="</a>";h+="</div>";h+="</div>";f.timeline.text=h;f.timeline.asset.media=j.content.thumbnail;f.timeline.type="storify";for(var e=0;e<j.content.elements.length;e++){var n=j.content.elements[e];var l=false;var k=new Date(n.posted_at);trace(n.type);var o={type:"storify",startDate:n.posted_at,endDate:n.posted_at,headline:" ",slug:"",text:"",asset:{media:"",credit:"",caption:""}};if(n.type=="image"){if(typeof n.source.name!="undefined"){if(n.source.name=="flickr"){o.asset.media="http://flickr.com/photos/"+n.meta.pathalias+"/"+n.meta.id+"/";o.asset.credit="<a href='"+o.asset.media+"'>"+n.attribution.name+"</a>";o.asset.credit+=" on <a href='"+n.source.href+"'>"+n.source.name+"</a>"}else{if(n.source.name=="instagram"){o.asset.media=n.permalink;o.asset.credit="<a href='"+n.permalink+"'>"+n.attribution.name+"</a>";o.asset.credit+=" on <a href='"+n.source.href+"'>"+n.source.name+"</a>"}else{o.asset.credit="<a href='"+n.permalink+"'>"+n.attribution.name+"</a>";if(typeof n.source.href!="undefined"){o.asset.credit+=" on <a href='"+n.source.href+"'>"+n.source.name+"</a>"}o.asset.media=n.data.image.src}}}else{o.asset.credit="<a href='"+n.permalink+"'>"+n.attribution.name+"</a>";o.asset.media=n.data.image.src}o.slug=n.attribution.name;if(typeof n.data.image.caption!="undefined"){if(n.data.image.caption!="undefined"){o.asset.caption=n.data.image.caption;o.slug=n.data.image.caption}}}else{if(n.type=="quote"){if(n.permalink.match("twitter")){o.asset.media=n.permalink;o.slug=VMM.Util.untagify(n.data.quote.text)}else{if(n.permalink.match("storify")){l=true;o.asset.media="<blockquote>"+n.data.quote.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</blockquote>"}}}else{if(n.type=="link"){o.headline=n.data.link.title;o.text=n.data.link.description;if(n.data.link.thumbnail!="undefined"&&n.data.link.thumbnail!=""){o.asset.media=n.data.link.thumbnail}else{o.asset.media=n.permalink}o.asset.caption="<a href='"+n.permalink+"' target='_blank'>"+n.data.link.title+"</a>";o.slug=n.data.link.title}else{if(n.type=="text"){if(n.permalink.match("storify")){l=true;var g=j.content.author.username;var c="";if(typeof n.attribution.name!="undefined"){b=n.attribution.name;a=n.attribution.username+"&nbsp;"}var m="<div class='storify'>";m+="<blockquote><p>"+n.data.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</p></blockquote>";m+="<div class='vcard author'><a class='screen-name url' href='"+n.attribution.href+"' target='_blank'>";m+="<span class='avatar'><img src='"+n.attribution.thumbnail+"' style='max-width: 32px; max-height: 32px;'></span>";m+="<span class='fn'>"+b+"</span>";m+="<span class='nickname'>"+a+"<span class='thumbnail-inline'></span></span>";m+="</a></div></div>";o.text=m;if((e+1)>=j.content.elements.length){o.startDate=j.content.elements[e-1].posted_at}else{if(j.content.elements[e+1].type=="text"&&j.content.elements[e+1].permalink.match("storify")){if((e+2)>=j.content.elements.length){o.startDate=j.content.elements[e-1].posted_at}else{if(j.content.elements[e+2].type=="text"&&j.content.elements[e+2].permalink.match("storify")){if((e+3)>=j.content.elements.length){o.startDate=j.content.elements[e-1].posted_at}else{if(j.content.elements[e+3].type=="text"&&j.content.elements[e+3].permalink.match("storify")){o.startDate=j.content.elements[e-1].posted_at}else{trace("LEVEL 3");o.startDate=j.content.elements[e+3].posted_at}}}else{trace("LEVEL 2");o.startDate=j.content.elements[e+2].posted_at}}}else{trace("LEVEL 1");o.startDate=j.content.elements[e+1].posted_at}}o.endDate=o.startDate}}else{if(n.type=="video"){o.headline=n.data.video.title;o.asset.caption=n.data.video.description;o.asset.caption=n.source.username;o.asset.media=n.data.video.src}else{trace("NO MATCH ");trace(n)}}}}}if(l){o.slug=VMM.Util.untagify(n.data.text)}f.timeline.date.push(o)}VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,f)}},tweets:{type:"twitter",buildData:function(a){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED");VMM.ExternalAPI.twitter.getTweets(a.timeline.tweets)},getData:function(a){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED");VMM.ExternalAPI.twitter.getTweetSearch(a)},onTwitterDataReady:function(c,f){var g=VMM.Timeline.DataObj.data_template_obj;for(var b=0;b<f.tweetdata.length;b++){var a={type:"tweets",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"};a.startDate=f.tweetdata[b].raw.created_at;if(type.of(f.tweetdata[b].raw.from_user_name)){a.headline=f.tweetdata[b].raw.from_user_name+" (<a href='https://twitter.com/"+f.tweetdata[b].raw.from_user+"'>@"+f.tweetdata[b].raw.from_user+"</a>)"}else{a.headline=f.tweetdata[b].raw.user.name+" (<a href='https://twitter.com/"+f.tweetdata[b].raw.user.screen_name+"'>@"+f.tweetdata[b].raw.user.screen_name+"</a>)"}a.asset.media=f.tweetdata[b].content;g.timeline.date.push(a)}VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,g)}}},data_template_obj:{timeline:{headline:"",description:"",asset:{media:"",credit:"",caption:""},date:[],era:[]}},date_obj:{startDate:"2012,2,2,11,30",headline:"",text:"",asset:{media:"http://youtu.be/vjVfu8-Wp6s",credit:"",caption:""},tags:"Optional"}}};
